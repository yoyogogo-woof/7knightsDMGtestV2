<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>774å‚·å®³è¨ˆç®—æ©Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    
    /* B æ¬„è‡ªå‹•åŒæ­¥æ™‚é¡¯ç¤ºé–é ­ */
    .lock-icon::after {
      content: "ğŸ”’";
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 13px;
      opacity: 0.75;
      pointer-events: none;
    }
    /* æ‰‹æ©Ÿä¹Ÿç¶­æŒä¸‰æ¬„ */
    .three-col-grid {
      display: grid;
      grid-template-columns: 1fr 0.8fr 0.8fr;
      gap: 4px;
      align-items: center;
    }
    .row {
      display: contents; /* è®“æ¯å€‹å­å…ƒç´ è‡ªç„¶è½åœ¨ä¸‰å€‹æ¬„ */
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-8">

  <h1 class="text-3xl font-bold mb-6">774å‚·å®³è¨ˆç®—æ©Ÿ</h1>

  <div class="bg-white shadow-lg rounded-2xl p-4 w-full max-w-5xl space-y-4 text-[15px] leading-tight mx-auto px-2">

    <!-- è¡¨é ­ -->
    <div class="three-col-grid font-semibold text-gray-700">
      <div>æ¬„ä½</div>
      <div class="text-center">è£å‚™ A</div>
      <div class="text-center">è£å‚™ B</div>
    </div>
    <hr class="border-gray-300">

    <!-- ä¸»è¼¸å‡ºå€ï¼ˆæ¨™é¡Œçœç•¥ï¼Œä¾ä½ çš„è¦æ±‚ï¼‰ -->
    <div class="three-col-grid">

      <!-- é¢æ¿æ”»æ“ŠåŠ› -->
      <div class="row">
        <label class="text-sm">é¢æ¿æ”»æ“ŠåŠ›</label>
        <div class="relative">
          <input id="A_atkPanel" type="number" class="border rounded p-1.5 w-full text-right" placeholder="">
        </div>
        <div class="relative">
          <input id="B_atkPanel" type="number" class="border rounded p-1.5 w-full text-right" placeholder="">
        </div>
      </div>

      <!-- åŸºç¤æ”»æ“ŠåŠ› -->
      <div class="row">
        <label class="text-sm">åŸºç¤æ”»æ“ŠåŠ›</label>
        <div class="relative">
          <input id="A_atkBase" type="number" class="border rounded p-1.5 w-full text-right" placeholder="">
        </div>
        <div class="relative">
          <input id="B_atkBase" type="number" class="border rounded p-1.5 w-full text-right" placeholder="">
        </div>
      </div>

      <!-- æ‹›å¼å€ç‡ -->
      <div class="row">
        <label class="text-sm">æ‹›å¼å€ç‡</label>
        <div class="relative">
          <input id="A_skillRate" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
        <div class="relative">
          <input id="B_skillRate" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>

      <!-- æš´æ“Šå‚·å®³ -->
      <div class="row">
        <label class="text-sm">æš´æ“Šå‚·å®³</label>
        <div class="relative">
          <input id="A_critDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
        <div class="relative">
          <input id="B_critDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>

      <!-- é™£å‹æå‡æ”»æ“ŠåŠ› -->
      <div class="row">
        <label class="text-sm">é™£å‹æå‡æ”»æ“ŠåŠ›</label>
        <div class="relative">
          <input id="A_formAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
        <div class="relative">
          <input id="B_formAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>
    </div>

    <!-- åˆ†éš”ç·šï¼ˆä¸‹æ‹‰é¸å–®ä¸Šæ–¹ï¼‰ -->
    <hr class="border-gray-300">

    <!-- å¥—è£æ•ˆæœï¼ˆå·¦å³é¸å–®åŒåˆ—ï¼‰ -->
    <div class="three-col-grid">
      <div class="row">
        <label class="text-sm">å¥—è£æ•ˆæœ</label>
        <div>
          <select id="A_setEffect" class="border rounded p-2 w-full">
            <option value="none">ç„¡å¥—è£æ•ˆæœ</option>
            <option value="tracker4">è¿½è¹¤è€…å››ä»¶å¥—ï¼ˆå¼±é»å‚·å®³ +35%ï¼‰</option>
            <option value="assassin4">åˆºå®¢å››ä»¶å¥—ï¼ˆç„¡è¦–é˜²ç¦¦ +15%ï¼‰</option>
            <option value="avenger2">å¾©ä»‡è€…å…©ä»¶å¥—ï¼ˆå‚·å®³é‡ +15%ï¼‰</option>
            <option value="avenger4">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆå‚·å®³é‡ +30%ï¼‰</option>
            <option value="avenger4Boss">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆBOSS å‚·å®³é‡ +70%ï¼‰</option>
          </select>
        </div>
        <div>
          <select id="B_setEffect" class="border rounded p-2 w-full">
            <option value="none">ç„¡å¥—è£æ•ˆæœ</option>
            <option value="tracker4">è¿½è¹¤è€…å››ä»¶å¥—ï¼ˆå¼±é»å‚·å®³ +35%ï¼‰</option>
            <option value="assassin4">åˆºå®¢å››ä»¶å¥—ï¼ˆç„¡è¦–é˜²ç¦¦ +15%ï¼‰</option>
            <option value="avenger2">å¾©ä»‡è€…å…©ä»¶å¥—ï¼ˆå‚·å®³é‡ +15%ï¼‰</option>
            <option value="avenger4">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆå‚·å®³é‡ +30%ï¼‰</option>
            <option value="avenger4Boss">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆBOSS å‚·å®³é‡ +70%ï¼‰</option>
          </select>
        </div>
      </div>
    </div>

    <!-- BUFF å€å¡Š -->
    <hr class="border-gray-300">
    <p class="text-lg font-semibold">ã€BUFFï¼ˆé¸å¡«ï¼‰ã€‘</p>
    <div class="three-col-grid">
      <div class="row">
        <label class="text-sm">æ”»æ“ŠåŠ›å¢åŠ </label>
        <div class="relative"><input id="A_buffAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_buffAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">å¼±é»å‚·å®³é‡å¢åŠ </label>
        <div class="relative"><input id="A_weakDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_weakDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">å‚·å®³é‡å¢åŠ </label>
        <div class="relative"><input id="A_revengeDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_revengeDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">æš´æ“Šå‚·å®³å¢åŠ </label>
        <div class="relative"><input id="A_buffCritDMG" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_buffCritDMG" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">æ¸›å°‘é˜²ç¦¦åŠ›</label>
        <div class="relative"><input id="A_deffDown" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_deffDown" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">ç„¡è¦–é˜²ç¦¦</label>
        <div class="relative"><input id="A_deffIgnore" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_deffIgnore" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
      </div>
    </div>
    <!-- BUFF ä¸‹æ–¹åˆ†éš”ç·š -->
    <hr class="border-gray-300">

    <!-- å¯µç‰©æ•ˆæœ -->
    <p class="text-lg font-semibold">ã€å¯µç‰©æ•ˆæœã€‘</p>
    <div class="three-col-grid">
      <div class="row">
        <label class="text-sm">å¯µç‰©æ”»æ“ŠåŠ›</label>
        <div><input id="A_petAtkFlat" type="number" class="border rounded p-1.5 w-full text-right"></div>
        <div><input id="B_petAtkFlat" type="number" class="border rounded p-1.5 w-full text-right"></div>
      </div>

      <div class="row">
        <label class="text-sm">æ½›èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›</label>
        <div class="relative"><input id="A_petAtkPercent" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-1.5 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_petAtkPercent" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-1.5 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">æŠ€èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›</label>
        <div class="relative"><input id="A_petSkillAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-1.5 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_petSkillAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-1.5 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">æŠ€èƒ½ï¼šå¢åŠ æš´æ“Šå‚·å®³</label>
        <div class="relative"><input id="A_petCritDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-1.5 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_petCritDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-1.5 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">æŠ€èƒ½ï¼šå¢åŠ å‚·å®³</label>
        <div class="relative"><input id="A_petDmgIncrese" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-1.5 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_petDmgIncrese" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-1.5 top-1.5 text-gray-400">%</span></div>
      </div>
    </div>
    <!-- å¯µç‰©æ•ˆæœ ä¸‹æ–¹åˆ†éš”ç·š -->
    <hr class="border-gray-300">

    <!-- æ•µæ–¹é˜²ç¦¦ -->
    <p class="text-lg font-semibold">ã€æ•µæ–¹é˜²ç¦¦ã€‘</p>
    <div class="three-col-grid">
      <div class="row">
        <label class="text-sm">æ•µæ–¹é˜²ç¦¦åŠ›</label>
        <div><input id="A_enemyDef" type="number" class="border rounded p-1.5 w-full text-right"></div>
        <div><input id="B_enemyDef" type="number" class="border rounded p-1.5 w-full text-right"></div>
      </div>

      <div class="row">
        <label class="text-sm">ç‰©ç†/é­”æ³•æ¸›å‚·</label>
        <div class="relative"><input id="A_reduceRate" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_reduceRate" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
      </div>

      <div class="row">
        <label class="text-sm">å¢åŠ é˜²ç¦¦åŠ›</label>
        <div class="relative"><input id="A_enemyDefIncrease" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
        <div class="relative"><input id="B_enemyDefIncrease" type="number" class="border rounded p-1.5 w-full text-right pr-6"><span class="absolute right-2 top-1.5 text-gray-400">%</span></div>
      </div>
    </div>
    <!-- æ•µæ–¹é˜²ç¦¦ ä¸‹æ–¹åˆ†éš”ç·š -->
    <hr class="border-gray-300">

    <!-- çµæœè¡¨ -->
    <div class="overflow-x-auto">
      <table class="w-full text-sm border border-gray-200">
        <thead>
          <tr class="bg-gray-50">
            <th class="p-2 border-b border-gray-200 text-left">é¡å‹</th>
            <th class="p-2 border-b border-gray-200 text-right">è£å‚™ A</th>
            <th class="p-2 border-b border-gray-200 text-right">è£å‚™ B</th>
          </tr>
        </thead>
        <tbody id="resultTable">
          <tr>
            <td class="p-2 border-b">ç„¡æš´æ“Šå¼±é»</td>
            <td class="p-2 border-b text-right" id="A_nono">-</td>
            <td class="p-2 border-b text-right" id="B_nono">-</td>
          </tr>
          <tr>
            <td class="p-2 border-b">åªè§¸ç™¼æš´æ“Š</td>
            <td class="p-2 border-b text-right" id="A_dmgCritOnly">-</td>
            <td class="p-2 border-b text-right" id="B_dmgCritOnly">-</td>
          </tr>
          <tr>
            <td class="p-2 border-b">åªè§¸ç™¼å¼±é»</td>
            <td class="p-2 border-b text-right" id="A_dmgWeakOnly">-</td>
            <td class="p-2 border-b text-right" id="B_dmgWeakOnly">-</td>
          </tr>
          <tr>
            <td class="p-2 border-b">æš´æ“Šï¼‹å¼±é»</td>
            <td class="p-2 border-b text-right text-blue-600 font-semibold" id="A_dmgBoth">-</td>
            <td class="p-2 border-b text-right text-blue-600 font-semibold" id="B_dmgBoth">-</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- å·®ç•°èˆ‡æ“ä½œ -->
    <div class="flex items-center justify-between">
      <div id="compareResult" class="text-base font-bold text-blue-600">è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼</div>
      <button id="resetBtn" class="bg-red-500 text-white px-5 py-2 rounded-xl hover:bg-red-600 transition">é‡è¨­æ‰€æœ‰æ•¸å€¼</button>
    </div>
  </div>

  <script>
  // æ¬„ä½æ¸…å–®
  const fieldList = [
    'atkPanel','atkBase','skillRate','critDmg','formAtk',
    'setEffect','buffAtk','weakDmg','revengeDmg','buffCritDMG',
    'deffDown','deffIgnore','petAtkFlat','petAtkPercent','petSkillAtk',
    'petCritDmg','petDmgIncrese','enemyDef','reduceRate','enemyDefIncrease'
  ];

  // å·¥å…·å‡½å¼
  const $ = (id) => document.getElementById(id);
  const get = (p, f) => $(`${p}_${f}`);
  const saveLS = (p, f, val) => localStorage.setItem(`${p}_${f}`, val ?? '');
  const loadLS = (p, f) => localStorage.getItem(`${p}_${f}`);

  // è¼‰å…¥å„²å­˜å€¼
  function loadAll() {
    ['A','B'].forEach(p=>{
      fieldList.forEach(f=>{
        const node = get(p,f);
        if (!node) return;
        const v = loadLS(p,f);
        if (v !== null) node.value = v;
      });
    });

    // åˆå§‹åŒ– B æ¬„ userEdited ç‹€æ…‹
    fieldList.forEach(f=>{
      const b = get('B',f);
      if (!b) return;
      const v = b.value;
      if (v && v !== '') {
        b.dataset.userEdited = 'true';
        b.classList.remove('bg-gray-200','lock-icon');
      } else {
        b.dataset.userEdited = 'false';
      }
    });
  }

  // è¨ˆç®—å‡½å¼
  function calc(prefix) {
    const v = (f) => parseFloat(get(prefix,f)?.value) || 0;

    const atkPanel = v('atkPanel');
    const atkBase = v('atkBase');
    const formAtk = v('formAtk')/100;
    const skillRate = v('skillRate')/100;
    const critDmg = v('critDmg')/100;

    const buffAtk = v('buffAtk')/100;
    const weakDmg = (v('weakDmg')+30)/100;
    const revengeDmg = v('revengeDmg')/100;
    const buffCritDMG = v('buffCritDMG')/100;
    const deffDown = v('deffDown')/100;
    const deffIgnore = v('deffIgnore')/100;

    const petAtkFlat = v('petAtkFlat');
    const petSkillAtk = v('petSkillAtk')/100;
    const petCritDmg = v('petCritDmg')/100;
    const petAtkPercent = v('petAtkPercent')/100;
    const petDmgIncrese = v('petDmgIncrese')/100;

    const enemyDef = v('enemyDef');
    const reduceRate = v('reduceRate')/100;
    const enemyDefIncrease = v('enemyDefIncrease')/100;

    const setEffect = get(prefix,'setEffect')?.value || 'none';

    let weakDmgTotal = weakDmg;
    let revengeDmgTotal = revengeDmg;
    let deffIgnoreTotal = deffIgnore;

    switch (setEffect) {
      case 'tracker4': weakDmgTotal += 0.35; break;
      case 'avenger2': revengeDmgTotal += 0.15; break;
      case 'avenger4': revengeDmgTotal += 0.30; break;
      case 'avenger4Boss': revengeDmgTotal += 0.70; break;
      case 'assassin4': deffIgnoreTotal += 0.15; break;
    }

    const DEF_CONST = 467;
    const defCalc = enemyDef * (1 - deffDown + enemyDefIncrease) * (1 - deffIgnoreTotal);
    const rawDefRate = Math.trunc ( ( defCalc / (DEF_CONST + defCalc) ) * 10000 ) / 10000 ;
    const defRate = (1 - rawDefRate) * (1 - reduceRate) ;

    const atkTotal = (atkPanel + atkBase * (formAtk + petAtkPercent) + petAtkFlat) * (1 + buffAtk + petSkillAtk);

    const dmgCritOnly = atkTotal * skillRate * (1 + (critDmg + petCritDmg + buffCritDMG - 1)) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;
    const dmgWeakOnly = atkTotal * skillRate * (1 + weakDmgTotal) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;
    const dmgBoth = atkTotal * skillRate * (1 + (critDmg + petCritDmg + buffCritDMG - 1)) * (1 + weakDmgTotal) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;
    const nono = atkTotal * skillRate * (1 + revengeDmgTotal + petDmgIncrese) * defRate;

    return { nono, dmgCritOnly, dmgWeakOnly, dmgBoth, defRate };
  }

  // é¡¯ç¤ºçµæœåˆ°è¡¨æ ¼
  function showResults(prefix, data) {
    const fmt = (x) => !x || x<=0 ? '-' : Math.round(x).toLocaleString();
    $(`${prefix}_nono`).textContent = fmt(data.nono);
    $(`${prefix}_dmgCritOnly`).textContent = fmt(data.dmgCritOnly);
    $(`${prefix}_dmgWeakOnly`).textContent = fmt(data.dmgWeakOnly);
    $(`${prefix}_dmgBoth`).textContent = fmt(data.dmgBoth);
  }

  // å·®ç•°é¡¯ç¤º
  function showDiff(a, b) {
    const box = $('compareResult');
    if (!a || !b || a<=0 || b<=0) { box.textContent = 'è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼'; return; }
    const diff = (b - a) / a * 100;
    const sign = diff >= 0 ? 'å¤š' : 'å°‘';
    const color = diff >= 0 ? 'text-green-600' : 'text-red-600';
    box.innerHTML = `B æ¯” A <span class="${color} font-bold">${sign}${Math.abs(diff).toFixed(2)}%</span>`;
  }

  // åŒæ­¥ï¼ˆA -> Bï¼‰åƒ…ç©ºç™½æˆ–æœªè¢«æ‰‹å‹•ç·¨è¼¯éçš„æ¬„ä½
  function syncField(field) {
    const a = get('A', field);
    const b = get('B', field);
    if (!a || !b) return;

    if (b.dataset.userEdited === 'true' && b.value !== '') return;

    b.value = a.value;
    b.dataset.autoSynced = 'true';
    b.classList.add('bg-gray-200','lock-icon');
    b.dataset.userEdited = 'false';
    saveLS('B', field, b.value);
  }

  function syncAll() {
    fieldList.forEach(syncField);
  }

  // æ›´æ–°æ•´é«”ç•«é¢
  function updateAll() {
    syncAll();

    const A = calc('A');
    const B = calc('B');
    showResults('A', A);
    showResults('B', B);
    showDiff(A.dmgBoth, B.dmgBoth);

    // é¡¯ç¤ºé›™æ–¹é˜²ç¦¦å€ç‡
    if (!$('defRateDisplay')) {
      const hr = document.querySelector('hr.border-gray-300:last-of-type');
      const div = document.createElement('div');
      div.id = 'defRateDisplay';
      div.className = 'text-sm text-gray-700 mt-2 ml-1 italic';
      div.innerHTML = `
        å¯¦éš›é˜²ç¦¦å€ç‡ï¼š
        <span id="defRateValueA" class="font-semibold text-blue-600">A: -</span>
        ï½œ 
        <span id="defRateValueB" class="font-semibold text-green-600">B: -</span>
      `;
      hr.parentNode.insertBefore(div, hr);
    }

    $('defRateValueA').textContent = `A: ${A.defRate ? A.defRate.toFixed(4) : '-'}`;
    $('defRateValueB').textContent = `B: ${B.defRate ? B.defRate.toFixed(4) : '-'}`;
  }

  // è¼¸å…¥äº‹ä»¶è™•ç†
  function onInput(e) {
    const node = e.target;
    const id = node.id;
    const [prefix, field] = id.split('_');

    saveLS(prefix, field, node.value);

    if (prefix === 'A') {
      syncField(field);
    } else if (prefix === 'B') {
      if (node.value !== '') {
        node.dataset.userEdited = 'true';
        node.classList.remove('bg-gray-200','lock-icon');
        delete node.dataset.autoSynced;
      } else {
        node.dataset.userEdited = 'false';
        syncField(field);
      }
    }

    updateAll();
  }

  // ç¶å®šæ‰€æœ‰ input/select
  function bindAll() {
    fieldList.forEach(f=>{
      const a = get('A',f), b = get('B',f);
      if (a) a.addEventListener('input', onInput);
      if (b) b.addEventListener('input', onInput);
    });
  }

  // é‡è¨­
  function resetAll() {
    if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸å€¼å—ï¼Ÿ')) return;
    fieldList.forEach(f=>{
      localStorage.removeItem(`A_${f}`);
      localStorage.removeItem(`B_${f}`);
      const a = get('A',f), b = get('B',f);
      if (a) a.value = '';
      if (b) {
        b.value = '';
        b.dataset.userEdited = 'false';
        b.classList.remove('bg-gray-200','lock-icon');
      }
    });
    ['A','B'].forEach(p=>{
      $(`${p}_nono`).textContent='-';
      $(`${p}_dmgCritOnly`).textContent='-';
      $(`${p}_dmgWeakOnly`).textContent='-';
      $(`${p}_dmgBoth`).textContent='-';
    });
    $('compareResult').textContent='è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼';
    $('defRateValueA').textContent = 'A: -';
    $('defRateValueB').textContent = 'B: -';
  }

  // åˆå§‹åŒ–
  loadAll();
  bindAll();
  syncAll();
  updateAll();
  $('resetBtn').addEventListener('click', resetAll);

  window.addEventListener('beforeunload', ()=>{
    fieldList.forEach(f=>{
      const a = get('A',f), b = get('B',f);
      if (a) saveLS('A',f,a.value);
      if (b) saveLS('B',f,b.value);
    });
  });
</script>

</body>
</html>






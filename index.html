<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>774å‚·å®³è¨ˆç®—æ©Ÿï¼ˆé›™æ¬„æ¯”è¼ƒç‰ˆï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .input-cell {
      display: grid;
      grid-template-columns: 1fr 60px 1fr;
      align-items: center;
      gap: 8px;
    }
    .input-cell input[type="number"] {
      text-align: right;
      padding-right: 1.5rem;
    }
    .percent-symbol {
      position: absolute;
      right: 6px;
      top: 5px;
      color: #9ca3af;
      font-size: 0.9rem;
    }
  </style>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-8">
  <h1 class="text-3xl font-bold mb-6">âš”ï¸ 774å‚·å®³è¨ˆç®—æ©Ÿï¼ˆé›™æ¬„æ¯”è¼ƒç‰ˆï¼‰</h1>

  <div class="grid grid-cols-3 gap-4 w-full max-w-6xl">
    <!-- å·¦æ¬„ -->
    <div id="col-left" class="bg-white shadow-lg rounded-2xl p-4 space-y-6 text-[15px]"></div>

    <!-- ä¸­é–“å·®å€¼ -->
    <div id="col-diff" class="flex flex-col justify-start items-center bg-transparent text-sm text-gray-600"></div>

    <!-- å³æ¬„ -->
    <div id="col-right" class="bg-white shadow-lg rounded-2xl p-4 space-y-6 text-[15px]"></div>
  </div>

  <script>
    /* === å€å¡Šè¨­å®š === */
    const sections = {
      main: { title: "ğŸ—¡ï¸ ä¸»è¼¸å‡º", fields: [
        ['atkPanel', 'é¢æ¿æ”»æ“ŠåŠ›'],
        ['atkBase', 'åŸºç¤æ”»æ“ŠåŠ›'],
        ['skillRate', 'æ‹›å¼å€ç‡', '%'],
        ['critDmg', 'æš´æ“Šå‚·å®³', '%'],
        ['formAtk', 'é™£å‹æå‡æ”»æ“ŠåŠ›', '%'],
        ['setEffect', 'å¥—è£æ•ˆæœ', 'select'],
      ]},
      buff: { title: "âœ¨ BUFFï¼ˆé¸å¡«ï¼‰", fields: [
        ['buffAtk', 'æ”»æ“ŠåŠ›å¢åŠ ', '%'],
        ['weakDmg', 'å¼±é»å‚·å®³é‡å¢åŠ ', '%'],
        ['revengeDmg', 'å‚·å®³é‡å¢åŠ ', '%'],
        ['buffCritDMG', 'æš´æ“Šå‚·å®³å¢åŠ ', '%'],
        ['deffDown', 'æ¸›å°‘é˜²ç¦¦åŠ›', '%'],
        ['deffIgnore', 'ç„¡è¦–é˜²ç¦¦', '%'],
      ]},
      pet: { title: "ğŸ¾ å¯µç‰©", fields: [
        ['petAtkFlat', 'å¯µç‰©æ”»æ“ŠåŠ›'],
        ['petAtkPercent', 'æ½›èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›', '%'],
        ['petSkillAtk', 'æŠ€èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›', '%'],
        ['petCritDmg', 'æŠ€èƒ½ï¼šå¢åŠ æš´æ“Šå‚·å®³', '%'],
        ['petDmgIncrese', 'æŠ€èƒ½ï¼šå¢åŠ å‚·å®³', '%'],
      ]},
      enemy: { title: "ğŸ›¡ï¸ æ•µäºº", fields: [
        ['enemyDef', 'æ•µæ–¹é˜²ç¦¦åŠ›'],
        ['reduceRate', 'ç‰©ç†/é­”æ³•æ¸›å‚·', '%'],
        ['enemyDefIncrease', 'å¢åŠ é˜²ç¦¦åŠ›', '%'],
      ]}
    };

    const setOptions = `
      <option value="none">ç„¡å¥—è£æ•ˆæœ</option>
      <option value="tracker4">è¿½è¹¤è€…å››ä»¶å¥—ï¼ˆå¼±é»å‚·å®³ +35%ï¼‰</option>
      <option value="avenger2">å¾©ä»‡è€…å…©ä»¶å¥—ï¼ˆå‚·å®³é‡ +15%ï¼‰</option>
      <option value="avenger4">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆå‚·å®³é‡ +30%ï¼‰</option>
      <option value="avenger4Boss">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆBOSS å‚·å®³é‡ +70%ï¼‰</option>
    `;

    const colLeft = document.getElementById("col-left");
    const colRight = document.getElementById("col-right");
    const colDiff = document.getElementById("col-diff");

    /* === å»ºç«‹UI === */
    Object.values(sections).forEach(sec => {
      // å·¦å³å€å¡Š
      const leftBlock = document.createElement("div");
      const rightBlock = document.createElement("div");
      const diffBlock = document.createElement("div");
      leftBlock.innerHTML = `<h2 class="text-lg font-semibold border-b pb-2 mb-3">${sec.title}</h2>`;
      rightBlock.innerHTML = `<h2 class="text-lg font-semibold border-b pb-2 mb-3">${sec.title}</h2>`;
      diffBlock.innerHTML = `<div class="h-8"></div>`;

      sec.fields.forEach(([id, label, unit]) => {
        leftBlock.innerHTML += `
          <div class="flex justify-between items-center mb-1">
            <label>${label}</label>
            ${
              unit === 'select'
                ? `<select id="${id}-left" class="border rounded p-1.5 w-40 text-sm">${setOptions}</select>`
                : `<div class="relative w-28">
                    <input id="${id}-left" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
                    ${unit === '%' ? `<span class="percent-symbol">%</span>` : ''}
                   </div>`
            }
          </div>`;

        diffBlock.innerHTML += `<div class="flex justify-center mb-2">
          ${unit !== 'select' ? `<input id="${id}-diff" type="number" class="border rounded w-14 text-center text-sm" placeholder="+/-">` : `<div class="h-9"></div>`}
        </div>`;

        rightBlock.innerHTML += `
          <div class="flex justify-between items-center mb-1">
            <label>${label}</label>
            ${
              unit === 'select'
                ? `<select id="${id}-right" class="border rounded p-1.5 w-40 text-sm bg-gray-100">${setOptions}</select>`
                : `<div class="relative w-28">
                    <input id="${id}-right" type="number" class="border rounded p-1.5 w-full text-right pr-6 bg-gray-100" placeholder="">
                    ${unit === '%' ? `<span class="percent-symbol">%</span>` : ''}
                   </div>`
            }
          </div>`;
      });

      colLeft.appendChild(leftBlock);
      colDiff.appendChild(diffBlock);
      colRight.appendChild(rightBlock);
    });

    /* === è¨ˆç®—å€ === */
    const calcZone = side => `
      <section class="text-center space-y-2 border-t pt-3 mt-3">
        <p class="text-base font-semibold">ğŸ“Š è¨ˆç®—çµæœ</p>
        <div id="result-${side}" class="text-sm text-gray-700 leading-relaxed">è«‹è¼¸å…¥æ•¸å€¼</div>
      </section>`;
    colLeft.innerHTML += calcZone("left");
    colRight.innerHTML += calcZone("right");

    /* === è¼¸å…¥å€¼ & è¨ˆç®— === */
    function val(id, side) {
      return parseFloat(document.getElementById(`${id}-${side}`).value) || 0;
    }

    function calculate(side) {
      const atkPanel = val('atkPanel', side);
      const atkBase = val('atkBase', side);
      const formAtk = val('formAtk', side) / 100;
      const skillRate = val('skillRate', side) / 100;
      const critDmg = val('critDmg', side) / 100;
      const buffAtk = val('buffAtk', side) / 100;
      const weakDmg = val('weakDmg', side) / 100;
      const revengeDmg = val('revengeDmg', side) / 100;
      const buffCritDMG = val('buffCritDMG', side) / 100;
      const deffDown = val('deffDown', side) / 100;
      const deffIgnore = val('deffIgnore', side) / 100;
      const petAtkFlat = val('petAtkFlat', side);
      const petSkillAtk = val('petSkillAtk', side) / 100;
      const petCritDmg = val('petCritDmg', side) / 100;
      const petAtkPercent = val('petAtkPercent', side) / 100;
      const petDmgIncrese = val('petDmgIncrese', side) / 100;
      const enemyDef = val('enemyDef', side);
      const reduceRate = val('reduceRate', side) / 100;
      const enemyDefIncrease = val('enemyDefIncrease', side) / 100;
      const setEffect = document.getElementById(`setEffect-${side}`).value;

      let weakDmgTotal = weakDmg, revengeDmgTotal = revengeDmg, deffIgnoreTotal = deffIgnore;
      switch (setEffect) {
        case 'tracker4': weakDmgTotal += 0.35; break;
        case 'avenger2': revengeDmgTotal += 0.15; break;
        case 'avenger4': revengeDmgTotal += 0.30; break;
        case 'avenger4Boss': revengeDmgTotal += 0.70; break;
      }

      const DEF_CONST = 467;
      const defRate = (1 - ((enemyDef * (1 - deffDown + enemyDefIncrease) * (1 - deffIgnoreTotal)) /
        (DEF_CONST + (enemyDef * (1 - deffDown + enemyDefIncrease) * (1 - deffIgnoreTotal))))) * (1 - reduceRate);

      const atkTotal = (atkPanel + atkBase * (formAtk + petAtkPercent) + petAtkFlat) * (1 + buffAtk + petSkillAtk);
      const dmgCrit = atkTotal * skillRate * (1 + (critDmg + petCritDmg + buffCritDMG - 1)) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;
      const dmgWeak = atkTotal * skillRate * (1 + weakDmgTotal) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;
      const dmgBoth = atkTotal * skillRate * (1 + (critDmg + petCritDmg + buffCritDMG - 1)) * (1 + weakDmgTotal) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;

      document.getElementById(`result-${side}`).innerHTML = `
        <p><b>åªæš´æ“Šï¼š</b>${Math.round(dmgCrit).toLocaleString()}</p>
        <p><b>åªå¼±é»ï¼š</b>${Math.round(dmgWeak).toLocaleString()}</p>
        <p><b>æš´æ“Šï¼‹å¼±é»ï¼š</b><span class="text-blue-600 font-bold">${Math.round(dmgBoth).toLocaleString()}</span></p>
      `;
      return dmgBoth;
    }

    function calculateBoth() {
      const dmgL = calculate("left");
      const dmgR = calculate("right");
      const diff = dmgL > 0 ? (((dmgR - dmgL) / dmgL) * 100).toFixed(2) : 0;
      document.getElementById("result-right").innerHTML += `<p class="text-green-600 font-semibold mt-2">å·®ç•°ï¼šç´„ ${diff}%</p>`;
    }

    /* === åŒæ­¥èˆ‡å·®å€¼é‚è¼¯ === */
    Object.values(sections).forEach(sec => {
      sec.fields.forEach(([id, , unit]) => {
        if (unit === 'select') {
          document.getElementById(`${id}-left`).addEventListener("change", e => {
            const right = document.getElementById(`${id}-right`);
            right.value = e.target.value;
            calculateBoth();
          });
          return;
        }

        const left = document.getElementById(`${id}-left`);
        const right = document.getElementById(`${id}-right`);
        const diff = document.getElementById(`${id}-diff`);

        const syncRight = () => {
          if (right.value === "") {
            right.value = left.value;
            right.classList.add("bg-gray-100");
          }
          calculateBoth();
        };

        const applyDiff = () => {
          const base = parseFloat(left.value) || 0;
          const delta = parseFloat(diff.value);
          if (!isNaN(delta)) {
            right.value = base + delta;
            right.classList.remove("bg-gray-100");
          } else {
            right.value = left.value;
            right.classList.add("bg-gray-100");
          }
          calculateBoth();
        };

        [left, right].forEach(el => el.addEventListener("input", calculateBoth));
        diff.addEventListener("input", applyDiff);
        left.addEventListener("input", syncRight);
      });
    });

  </script>
</body>
</html>

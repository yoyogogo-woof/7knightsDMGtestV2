<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>é›™æ¬„è£å‚™æ¯”è¼ƒ</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  input[type="number"]::-webkit-inner-spin-button {
    opacity: 1;
  }
  .input-box {
    text-align: right;
    padding-right: 22px;
    border: 1px solid #ddd;
    border-radius: 6px;
    height: 30px;
    width: 100%;
  }
  .gray-input {
    background-color: #f3f4f6;
  }
  .percent-box {
    position: relative;
  }
  .percent-box::after {
    content: "%";
    position: absolute;
    right: 8px;
    top: 4px;
    color: #555;
    font-size: 0.9rem;
  }
  .diff-box {
    text-align: right;
    padding-right: 18px;
    border: 1px solid #ccc;
    border-radius: 6px;
    height: 30px;
    background-color: #fff;
  }
  .diff-box::after {
    content: "%";
    position: absolute;
    right: 6px;
    color: #666;
  }
  .section-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
  }
</style>
</head>

<body class="bg-gray-100 flex flex-col items-center py-6">
  <div class="flex gap-10">
    <!-- å·¦æ¬„ -->
    <div id="leftPanel" class="bg-white shadow rounded-2xl p-4 w-[320px]">
      <h3 class="section-title">ğŸ›  ä¸»è¼¸å‡º</h3>
      <div class="grid gap-2" id="mainOutputLeft"></div>

      <h3 class="section-title">âœ¨ BUFFï¼ˆé¸å¡«ï¼‰</h3>
      <div class="grid gap-2" id="buffLeft"></div>

      <h3 class="section-title">ğŸ‰ å¯µç‰©</h3>
      <div class="grid gap-2" id="petLeft"></div>

      <h3 class="section-title">ğŸ›¡ æ•µäºº</h3>
      <div class="grid gap-2" id="enemyLeft"></div>
    </div>

    <!-- ä¸­é–“å·®å€¼æ¬„ -->
    <div id="diffPanel" class="flex flex-col justify-start mt-9 gap-[14px] w-[70px] text-center"></div>

    <!-- å³æ¬„ -->
    <div id="rightPanel" class="bg-white shadow rounded-2xl p-4 w-[320px]">
      <h3 class="section-title">ğŸ›  ä¸»è¼¸å‡º</h3>
      <div class="grid gap-2" id="mainOutputRight"></div>

      <h3 class="section-title">âœ¨ BUFFï¼ˆé¸å¡«ï¼‰</h3>
      <div class="grid gap-2" id="buffRight"></div>

      <h3 class="section-title">ğŸ‰ å¯µç‰©</h3>
      <div class="grid gap-2" id="petRight"></div>

      <h3 class="section-title">ğŸ›¡ æ•µäºº</h3>
      <div class="grid gap-2" id="enemyRight"></div>
    </div>
  </div>

  <!-- çµæœé¡¯ç¤º -->
  <div class="bg-white shadow rounded-2xl p-4 mt-8 w-[720px] text-center">
    <h3 class="text-lg font-semibold mb-3">ğŸ“Š è¨ˆç®—çµæœ</h3>
    <p id="leftResult" class="text-gray-700 mb-1"></p>
    <p id="rightResult" class="text-gray-700 mb-1"></p>
    <p id="compareResult" class="font-semibold mt-2"></p>
  </div>

<script>
const fields = [
  { name: "é¢æ¿æ”»æ“ŠåŠ›", type: "number" },
  { name: "åŸºç¤æ”»æ“ŠåŠ›", type: "number" },
  { name: "æ‹›å¼å€ç‡", type: "percent" },
  { name: "æš´æ“Šå‚·å®³", type: "percent" },
  { name: "é™£å‹æå‡æ”»æ“ŠåŠ›", type: "percent" },
  { name: "æ”»æ“ŠåŠ›å¢åŠ ", type: "percent", section: "buff" },
  { name: "å¼±é»å‚·å®³å¢åŠ ", type: "percent", section: "buff" },
  { name: "å‚·å®³é‡å¢åŠ ", type: "percent", section: "buff" },
  { name: "æš´æ“Šå‚·å®³å¢åŠ ", type: "percent", section: "buff" },
  { name: "æ¸›å°‘é˜²ç¦¦åŠ›", type: "percent", section: "buff" },
  { name: "ç„¡è¦–é˜²ç¦¦", type: "percent", section: "buff" },
  { name: "å¯µç‰©æ”»æ“ŠåŠ›", type: "number", section: "pet" },
  { name: "æ•µæ–¹é˜²ç¦¦åŠ›", type: "number", section: "enemy" },
  { name: "ç‰©ç†/é­”æ³•æ¸›å‚·", type: "percent", section: "enemy" },
  { name: "å¢åŠ é˜²ç¦¦åŠ›", type: "percent", section: "enemy" },
];

function createRow(field, index) {
  const leftDiv = document.getElementById(field.section ? `${field.section}Left` : "mainOutputLeft");
  const rightDiv = document.getElementById(field.section ? `${field.section}Right` : "mainOutputRight");
  const diffDiv = document.getElementById("diffPanel");

  const leftInput = document.createElement("input");
  leftInput.type = "number";
  leftInput.className = `input-box ${field.type === "percent" ? "percent-box" : ""}`;
  leftInput.id = `left-${index}`;

  const rightInput = document.createElement("input");
  rightInput.type = "number";
  rightInput.className = `input-box gray-input ${field.type === "percent" ? "percent-box" : ""}`;
  rightInput.id = `right-${index}`;

  const diffInput = document.createElement("input");
  diffInput.type = "number";
  diffInput.placeholder = "+/-";
  diffInput.className = `diff-box ${field.type === "percent" ? "percent-box" : ""}`;
  diffInput.id = `diff-${index}`;

  function syncRight() {
    if (diffInput.value === "" && document.activeElement !== rightInput) {
      rightInput.value = leftInput.value;
      rightInput.classList.add("gray-input");
    }
  }

  leftInput.addEventListener("input", () => {
    if (diffInput.value === "") syncRight();
    updateResult();
  });

  diffInput.addEventListener("input", () => {
    const base = parseFloat(leftInput.value) || 0;
    const diff = parseFloat(diffInput.value);
    if (diffInput.value === "") {
      rightInput.value = leftInput.value;
      rightInput.classList.add("gray-input");
    } else if (!isNaN(diff)) {
      rightInput.value = base + diff;
      rightInput.classList.remove("gray-input");
    }
    updateResult();
  });

  rightInput.addEventListener("input", () => {
    if (rightInput.value !== leftInput.value) {
      rightInput.classList.remove("gray-input");
    } else {
      rightInput.classList.add("gray-input");
    }
    updateResult();
  });

  const label = document.createElement("label");
  label.textContent = field.name;
  label.className = "whitespace-nowrap";

  const leftRow = document.createElement("div");
  leftRow.className = "flex justify-between items-center gap-2";
  leftRow.append(label, leftInput);
  leftDiv.appendChild(leftRow);

  const rightRow = document.createElement("div");
  rightRow.className = "flex justify-between items-center gap-2";
  rightRow.append(label.cloneNode(true), rightInput);
  rightDiv.appendChild(rightRow);

  const diffWrapper = document.createElement("div");
  diffWrapper.appendChild(diffInput);
  diffDiv.appendChild(diffWrapper);
}

fields.forEach((f, i) => createRow(f, i));

function calcDamage(values) {
  const atk = parseFloat(values["é¢æ¿æ”»æ“ŠåŠ›"]) || 0;
  const base = parseFloat(values["åŸºç¤æ”»æ“ŠåŠ›"]) || 0;
  const skill = (parseFloat(values["æ‹›å¼å€ç‡"]) || 0) / 100;
  const critDmg = 1 + (parseFloat(values["æš´æ“Šå‚·å®³"]) || 0) / 100;
  const buff = 1 + (parseFloat(values["å‚·å®³é‡å¢åŠ "]) || 0) / 100;
  const pet = parseFloat(values["å¯µç‰©æ”»æ“ŠåŠ›"]) || 0;

  const normal = (atk + base + pet) * skill * buff;
  const onlyCrit = normal * critDmg;
  const onlyWeak = normal * 1.35;
  const both = normal * critDmg * 1.35;

  return { onlyCrit, onlyWeak, both };
}

function updateResult() {
  const leftValues = {};
  const rightValues = {};

  fields.forEach((f, i) => {
    leftValues[f.name] = document.getElementById(`left-${i}`).value;
    rightValues[f.name] = document.getElementById(`right-${i}`).value;
  });

  const left = calcDamage(leftValues);
  const right = calcDamage(rightValues);

  document.getElementById("leftResult").innerHTML = `
    å·¦æ¬„ï¼šæš´æ“Š ${left.onlyCrit.toFixed(0)} ï½œ å¼±é» ${left.onlyWeak.toFixed(0)} ï½œ åŒæ™‚ ${left.both.toFixed(0)}
  `;
  document.getElementById("rightResult").innerHTML = `
    å³æ¬„ï¼šæš´æ“Š ${right.onlyCrit.toFixed(0)} ï½œ å¼±é» ${right.onlyWeak.toFixed(0)} ï½œ åŒæ™‚ ${right.both.toFixed(0)}
  `;

  const diff = ((right.both - left.both) / left.both) * 100;
  document.getElementById("compareResult").innerHTML =
    `å·®ç•°ï¼š${diff >= 0 ? "+" : ""}${diff.toFixed(2)}%`;
}
</script>
</body>
</html>

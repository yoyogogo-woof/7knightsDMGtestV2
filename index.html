<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>774傷害計算機（雙欄比較版）</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-8">

<h1 class="text-3xl font-bold mb-6">774傷害計算機（裝備A vs 裝備B）</h1>

<div class="w-full max-w-[1100px] flex flex-col lg:flex-row gap-6">

  <!-- 裝備 A -->
  <div class="bg-white shadow-lg rounded-2xl p-4 flex-1 space-y-6 text-[15px] leading-tight">
    <h2 class="text-lg font-semibold border-b pb-2 mb-4">裝備A</h2>
    <div id="formA" class="space-y-2">
      <!-- 攻擊欄位 -->
      <div class="flex justify-between items-center">
        <label>面板攻擊力</label>
        <input id="A_atkPanel" type="number" class="border rounded p-1.5 w-28 text-right" placeholder="輸入數值">
      </div>
      <div class="flex justify-between items-center">
        <label>基礎攻擊力</label>
        <input id="A_atkBase" type="number" class="border rounded p-1.5 w-28 text-right" placeholder="輸入數值">
      </div>
      <div class="flex justify-between items-center">
        <label>招式倍率</label>
        <div class="relative w-28">
          <input id="A_skillRate" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="輸入數值">
          <span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>
      <div class="flex justify-between items-center">
        <label>暴擊傷害</label>
        <div class="relative w-28">
          <input id="A_critDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="輸入數值">
          <span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>
      <div class="flex justify-between items-center">
        <label>陣型提升攻擊力</label>
        <div class="relative w-28">
          <input id="A_formAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="輸入數值">
          <span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>

      <!-- 套裝效果 -->
      <div class="mt-4 border-t pt-3">
        <select id="A_setEffect" class="border rounded p-2 w-full">
          <option value="none">無套裝效果</option>
          <option value="tracker4">追蹤者四件套（弱點傷害 +35%）</option>
          <option value="assassin4">刺客四件套（無視防禦 +15%）</option>
          <option value="avenger2">復仇者兩件套（傷害量 +15%）</option>
          <option value="avenger4">復仇者四件套（傷害量 +30%）</option>
          <option value="avenger4Boss">復仇者四件套（BOSS 傷害量 +70%）</option>
        </select>
      </div>

      <!-- BUFF -->
      <section class="mt-4">
        <h3 class="text-md font-semibold border-b pb-1 mb-2">BUFF（選填）</h3>
        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <label>攻擊力增加</label>
            <div class="relative w-28">
              <input id="A_buffAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>弱點傷害量增加</label>
            <div class="relative w-28">
              <input id="A_weakDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>傷害量增加</label>
            <div class="relative w-28">
              <input id="A_revengeDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>暴擊傷害增加</label>
            <div class="relative w-28">
              <input id="A_buffCritDMG" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>減少防禦力</label>
            <div class="relative w-28">
              <input id="A_deffDown" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>無視防禦</label>
            <div class="relative w-28">
              <input id="A_deffIgnore" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
        </div>
      </section>

      <!-- 寵物 -->
      <section class="mt-4">
        <h3 class="text-md font-semibold border-b pb-1 mb-2">寵物效果</h3>
        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <label>寵物攻擊力</label>
            <input id="A_petAtkFlat" type="number" class="border rounded p-1.5 w-28 text-right" placeholder="">
          </div>
          <div class="flex justify-between items-center">
            <label>潛能：增加攻擊力</label>
            <div class="relative w-28">
              <input id="A_petAtkPercent" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>技能：增加攻擊力</label>
            <div class="relative w-28">
              <input id="A_petSkillAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>技能：增加暴擊傷害</label>
            <div class="relative w-28">
              <input id="A_petCritDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>技能：增加傷害</label>
            <div class="relative w-28">
              <input id="A_petDmgIncrese" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
        </div>
      </section>

      <!-- 敵人 -->
      <section class="mt-4">
        <h3 class="text-md font-semibold border-b pb-1 mb-2">敵方防禦</h3>
        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <label>敵方防禦力</label>
            <input id="A_enemyDef" type="number" class="border rounded p-1.5 w-28 text-right" placeholder="">
          </div>
          <div class="flex justify-between items-center">
            <label>物理/魔法減傷</label>
            <div class="relative w-28">
              <input id="A_reduceRate" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>增加防禦力</label>
            <div class="relative w-28">
              <input id="A_enemyDefIncrease" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
        </div>
      </section>

      <!-- 結果 -->
      <section class="text-center space-y-2 border-t pt-3">
        <p class="text-base font-semibold">【A 結果】</p>
        <div id="A_result" class="text-sm text-gray-700 leading-relaxed">
          請輸入數值
        </div>
      </section>
    </div>
  </div>

  <!-- 中間比較區塊 -->
  <div class="flex flex-col justify-center items-center text-center p-4 bg-gray-200 rounded-xl space-y-2">
    <p class="text-lg font-semibold">📊 傷害比較（B vs A）</p>
    <div id="diffResult" class="text-blue-600 font-bold text-base">
      尚未計算
    </div>
  </div>

  <!-- 裝備 B -->
  <div class="bg-white shadow-lg rounded-2xl p-4 flex-1 space-y-6 text-[15px] leading-tight">
    <h2 class="text-lg font-semibold border-b pb-2 mb-4">裝備B</h2>
    <div id="formB" class="space-y-2">
      <!-- B 欄位完全同 A，但 id 全改為 B_ -->
      <!-- 自動灰底同步 A，手動輸入變白 -->
      <!-- 下面欄位可用 JS 生成或手動複製填寫 -->
    </div>
  </div>

</div>

<script>
// 全部欄位
const fields = [
  'atkPanel','atkBase','formAtk','buffAtk','skillRate','critDmg',
  'weakDmg','revengeDmg','petAtkFlat','petSkillAtk','petCritDmg',
  'petAtkPercent','enemyDef','reduceRate','setEffect','buffCritDMG',
  'deffDown','deffIgnore','enemyDefIncrease','petDmgIncrese'
];

// 初始化欄位、同步 localStorage
function initForm(prefix){
  fields.forEach(id=>{
    const el = document.getElementById(`${prefix}_${id}`);
    if(!el) return;
    // 載入 localStorage
    const saved = localStorage.getItem(`${prefix}_${id}`);
    if(saved!==null) el.value=saved;
    el.addEventListener('input',()=>{
      localStorage.setItem(`${prefix}_${id}`, el.value);
      calculate();
    });
  });
}
initForm('A');
initForm('B');

// B 欄同步 A (灰底)
function syncBtoA(){
  fields.forEach(id=>{
    const elA = document.getElementById(`A_${id}`);
    const elB = document.getElementById(`B_${id}`);
    if(!elB || !elA) return;
    if(elB.value===''){
      elB.value = elA.value;
      elB.style.backgroundColor='#e5e7eb'; // 灰色
    } else {
      elB.style.backgroundColor='white';
    }
    elB.addEventListener('input',()=>{
      if(elB.value===''){
        elB.value=elA.value;
        elB.style.backgroundColor='#e5e7eb';
      } else {
        elB.style.backgroundColor='white';
      }
      calculate();
    });
  });
}

// 計算傷害公式
function calculate(){
  ['A','B'].forEach(prefix=>{
    const v=id=>parseFloat(document.getElementById(`${prefix}_${id}`).value)||0;
    const atkPanel=v('atkPanel'), atkBase=v('atkBase'), formAtk=v('formAtk')/100,
          skillRate=v('skillRate')/100, critDmg=v('critDmg')/100,
          buffAtk=v('buffAtk')/100, weakDmg=(v('weakDmg')+30)/100,
          revengeDmg=v('revengeDmg')/100, buffCritDMG=v('buffCritDMG')/100,
          deffDown=v('deffDown')/100, deffIgnore=v('deffIgnore')/100,
          petAtkFlat=v('petAtkFlat'), petSkillAtk=v('petSkillAtk')/100,
          petCritDmg=v('petCritDmg')/100, petAtkPercent=v('petAtkPercent')/100,
          petDmgIncrese=v('petDmgIncrese')/100, enemyDef=v('enemyDef'),
          reduceRate=v('reduceRate')/100, enemyDefIncrease=v('enemyDefIncrease')/100;
    let weakDmgTotal=weakDmg, revengeDmgTotal=revengeDmg, deffIgnoreTotal=deffIgnore;
    const setEffect=document.getElementById(`${prefix}_setEffect`).value;
    switch(setEffect){
      case 'tracker4': weakDmgTotal+=0.35; break;
      case 'avenger2': revengeDmgTotal+=0.15; break;
      case 'avenger4': revengeDmgTotal+=0.30; break;
      case 'avenger4Boss': revengeDmgTotal+=0.70; break;
      case 'assassin4': deffIgnoreTotal+=0.15; break;
    }
    const DEF_CONST=467;
    const defRate=(1-((enemyDef*(1-deffDown+enemyDefIncrease)*(1-deffIgnoreTotal))/(DEF_CONST+(enemyDef*(1-deffDown+enemyDefIncrease)*(1-deffIgnoreTotal)))))*(1-reduceRate);
    const atkTotal=(atkPanel+atkBase*(formAtk+petAtkPercent)+petAtkFlat)*(1+buffAtk+petSkillAtk);
    const dmgCritOnly=atkTotal*skillRate*(1+(critDmg+petCritDmg+buffCritDMG-1))*(1+revengeDmgTotal+petDmgIncrese)*defRate;
    const dmgWeakOnly=atkTotal*skillRate*(1+weakDmgTotal)*(1+revengeDmgTotal+petDmgIncrese)*defRate;
    const dmgBoth=atkTotal*skillRate*(1+(critDmg+petCritDmg+buffCritDMG-1))*(1+weakDmgTotal)*(1+revengeDmgTotal+petDmgIncrese)*defRate;
    const resultEl=document.getElementById(`${prefix}_result`);
    if(isNaN(dmgBoth)||dmgBoth<=0){
      resultEl.innerHTML='<span class="text-gray-400">請輸入完整數值</span>';
    }else{
      resultEl.innerHTML=`
      <div class="space-y-2">
        <p><b>只觸發暴擊：</b> ${Math.round(dmgCritOnly).toLocaleString()}</p>
        <p><b>只觸發弱點：</b> ${Math.round(dmgWeakOnly).toLocaleString()}</p>
        <p><b>暴擊＋弱點：</b> <span class="text-blue-600 font-bold">${Math.round(dmgBoth).toLocaleString()}</span></p>
      </div>`;
    }
    // 存入計算結果
    window[`${prefix}_dmgBoth`] = dmgBoth;
  });
  // 顯示比較差異
  const diffEl=document.getElementById('diffResult');
  const diffA=window.A_dmgBoth||0, diffB=window.B_dmgBoth||0;
  if(diffA>0 && diffB>0){
    const diffVal=Math.round(diffB-diffA);
    diffEl.innerHTML=`差異：<span class="text-red-600">${diffVal.toLocaleString()}</span> (${diffB>=diffA?'+':'-'}${Math.abs(diffVal)/diffA*100?.toFixed(2):0}%)`;
  }else{
    diffEl.innerHTML='尚未計算';
  }
}

// 初始化 B 欄同步 A
syncBtoA();

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>774 é›™è£å‚™æ¯”è¼ƒè¨ˆç®—æ©Ÿï¼ˆæœ€çµ‚ç‰ˆï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .lock-icon::after {
      content: "ğŸ”’";
      position: absolute;
      top: 3px;
      right: 4px;
      font-size: 13px;
      opacity: 0.7;
    }

    /* æ‰‹æ©Ÿä¹Ÿä¿æŒé›™æ¬„æ©«æ’ */
    @media (max-width: 768px) {
      .calc-container {
        flex-direction: row !important;
        flex-wrap: wrap;
      }
      .calc-box {
        width: 100%;
        max-width: 50%;
      }
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-8">

  <h1 class="text-3xl font-bold mb-6">774 é›™è£å‚™æ¯”è¼ƒè¨ˆç®—æ©Ÿ</h1>

  <!-- å…©æ¬„å®¹å™¨ -->
  <div class="calc-container flex flex-row gap-6 w-full max-w-6xl justify-center">

    <!-- è£å‚™A -->
    <div class="calc-box bg-white shadow-lg rounded-2xl p-4 w-full md:w-1/2 space-y-6 text-[15px]" id="A">
      <h2 class="text-lg font-semibold border-b pb-2 mb-4 text-center">ã€è£å‚™ Aã€‘</h2>
      <div id="contentA"></div>
      <section class="text-center space-y-2 border-t pt-3">
        <p class="text-base font-semibold">ã€è¨ˆç®—çµæœã€‘</p>
        <div id="resultA" class="text-sm text-gray-700 leading-relaxed">è«‹è¼¸å…¥æ•¸å€¼</div>
      </section>
    </div>

    <!-- è£å‚™B -->
    <div class="calc-box bg-white shadow-lg rounded-2xl p-4 w-full md:w-1/2 space-y-6 text-[15px]" id="B">
      <h2 class="text-lg font-semibold border-b pb-2 mb-4 text-center">ã€è£å‚™ Bã€‘</h2>
      <div id="contentB"></div>
      <section class="text-center space-y-2 border-t pt-3">
        <p class="text-base font-semibold">ã€è¨ˆç®—çµæœã€‘</p>
        <div id="resultB" class="text-sm text-gray-700 leading-relaxed">è«‹è¼¸å…¥æ•¸å€¼</div>
      </section>
    </div>

  </div>

  <!-- å·®ç•°é¡¯ç¤º -->
  <div class="mt-6 bg-white shadow-md rounded-xl p-4 text-center w-full max-w-md">
    <p class="text-base font-semibold mb-2">ã€è£å‚™å·®ç•°ã€‘</p>
    <div id="compareResult" class="text-lg font-bold text-blue-600">è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼</div>
    <button id="resetBtn" class="mt-4 bg-red-500 text-white px-5 py-2 rounded-xl hover:bg-red-600 transition">é‡è¨­æ‰€æœ‰æ•¸å€¼</button>
  </div>

  <script>
    const fields = [
      'atkPanel','atkBase','formAtk','buffAtk','skillRate','critDmg',
      'weakDmg','revengeDmg','petAtkFlat','petSkillAtk','petCritDmg',
      'petAtkPercent','enemyDef','reduceRate','setEffect','buffCritDMG',
      'deffDown','deffIgnore','enemyDefIncrease','petDmgIncrese'
    ];

    function buildPanelHtml() {
      return `
        <section>
          <div class="space-y-2">
            ${inputRow('atkPanel','é¢æ¿æ”»æ“ŠåŠ›')}
            ${inputRow('atkBase','åŸºç¤æ”»æ“ŠåŠ›')}
            ${inputRow('skillRate','æ‹›å¼å€ç‡','%')}
            ${inputRow('critDmg','æš´æ“Šå‚·å®³','%')}
            ${inputRow('formAtk','é™£å‹æå‡æ”»æ“ŠåŠ›','%')}
          </div>

          <hr class="my-4 border-gray-300">

          <div class="mt-4">
            <select id="setEffect" class="border rounded p-2 w-full">
              <option value="none">ç„¡å¥—è£æ•ˆæœ</option>
              <option value="tracker4">è¿½è¹¤è€…å››ä»¶å¥—ï¼ˆå¼±é»å‚·å®³ +35%ï¼‰</option>
              <option value="assassin4">åˆºå®¢å››ä»¶å¥—ï¼ˆç„¡è¦–é˜²ç¦¦ +15%ï¼‰</option>
              <option value="avenger2">å¾©ä»‡è€…å…©ä»¶å¥—ï¼ˆå‚·å®³é‡ +15%ï¼‰</option>
              <option value="avenger4">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆå‚·å®³é‡ +30%ï¼‰</option>
              <option value="avenger4Boss">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆBOSS å‚·å®³é‡ +70%ï¼‰</option>
            </select>
          </div>

          <hr class="my-4 border-gray-300">

          <h2 class="text-lg font-semibold mb-2">ã€BUFFï¼ˆé¸å¡«ï¼‰ã€‘</h2>
          <div class="space-y-2">
            ${inputRow('buffAtk','æ”»æ“ŠåŠ›å¢åŠ ','%')}
            ${inputRow('weakDmg','å¼±é»å‚·å®³é‡å¢åŠ ','%')}
            ${inputRow('revengeDmg','å‚·å®³é‡å¢åŠ ','%')}
            ${inputRow('buffCritDMG','æš´æ“Šå‚·å®³å¢åŠ ','%')}
            ${inputRow('deffDown','æ¸›å°‘é˜²ç¦¦åŠ›','%')}
            ${inputRow('deffIgnore','ç„¡è¦–é˜²ç¦¦','%')}
          </div>

          <hr class="my-4 border-gray-300">

          <h2 class="text-lg font-semibold mb-2">ã€å¯µç‰©æ•ˆæœã€‘</h2>
          <div class="space-y-2">
            ${inputRow('petAtkFlat','å¯µç‰©æ”»æ“ŠåŠ›')}
            ${inputRow('petAtkPercent','æ½›èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›','%')}
            ${inputRow('petSkillAtk','æŠ€èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›','%')}
            ${inputRow('petCritDmg','æŠ€èƒ½ï¼šå¢åŠ æš´æ“Šå‚·å®³','%')}
            ${inputRow('petDmgIncrese','æŠ€èƒ½ï¼šå¢åŠ å‚·å®³','%')}
          </div>

          <hr class="my-4 border-gray-300">

          <h2 class="text-lg font-semibold mb-2">ã€æ•µæ–¹é˜²ç¦¦ã€‘</h2>
          <div class="space-y-2">
            ${inputRow('enemyDef','æ•µæ–¹é˜²ç¦¦åŠ›')}
            ${inputRow('reduceRate','ç‰©ç†/é­”æ³•æ¸›å‚·','%')}
            ${inputRow('enemyDefIncrease','å¢åŠ é˜²ç¦¦åŠ›','%')}
          </div>

          <hr class="my-4 border-gray-300">
        </section>
      `;
    }

    function inputRow(id,label,unit){
      return `
      <div class="flex justify-between items-center">
        <label>${label}</label>
        <div class="relative w-28">
          <input id="${id}" type="number" class="border rounded p-1.5 w-full text-right pr-6">
          ${unit?`<span class="absolute right-2 top-1.5 text-gray-400">${unit}</span>`:''}
        </div>
      </div>`;
    }

    document.getElementById('contentA').innerHTML=buildPanelHtml();
    document.getElementById('contentB').innerHTML=buildPanelHtml();

    const el=(p,id)=>document.querySelector(`#${p} #${id}`);
    const save=(p,id,v)=>localStorage.setItem(`${p}_${id}`,v);
    const load=(p,id)=>localStorage.getItem(`${p}_${id}`);

    function loadSaved(){
      ['A','B'].forEach(p=>{
        fields.forEach(id=>{
          const v=load(p,id);
          const node=el(p,id);
          if(node&&v!==null)node.value=v;
        });
      });
    }

    function calculate(prefix){
      const v=id=>parseFloat(el(prefix,id)?.value)||0;
      const atkPanel=v('atkPanel'),atkBase=v('atkBase'),formAtk=v('formAtk')/100,skillRate=v('skillRate')/100,critDmg=v('critDmg')/100;
      const buffAtk=v('buffAtk')/100,weakDmg=(v('weakDmg')+30)/100,revengeDmg=v('revengeDmg')/100,buffCritDMG=v('buffCritDMG')/100,deffDown=v('deffDown')/100,deffIgnore=v('deffIgnore')/100;
      const petAtkFlat=v('petAtkFlat'),petSkillAtk=v('petSkillAtk')/100,petCritDmg=v('petCritDmg')/100,petAtkPercent=v('petAtkPercent')/100,petDmgIncrese=v('petDmgIncrese')/100;
      const enemyDef=v('enemyDef'),reduceRate=v('reduceRate')/100,enemyDefIncrease=v('enemyDefIncrease')/100;
      const setEffect=el(prefix,'setEffect').value;
      let weakDmgTotal=weakDmg,revengeDmgTotal=revengeDmg,deffIgnoreTotal=deffIgnore;
      switch(setEffect){
        case'tracker4':weakDmgTotal+=0.35;break;
        case'avenger2':revengeDmgTotal+=0.15;break;
        case'avenger4':revengeDmgTotal+=0.30;break;
        case'avenger4Boss':revengeDmgTotal+=0.70;break;
        case'assassin4':deffIgnoreTotal+=0.15;break;
      }
      const DEF_CONST=467;
      const defRate=(1-((enemyDef*(1-deffDown+enemyDefIncrease)*(1-deffIgnoreTotal))/(DEF_CONST+(enemyDef*(1-deffDown+enemyDefIncrease)*(1-deffIgnoreTotal)))))*(1-reduceRate);
      const atkTotal=(atkPanel+atkBase*(formAtk+petAtkPercent)+petAtkFlat)*(1+buffAtk+petSkillAtk);
      const dmgCritOnly=atkTotal*skillRate*(1+(critDmg+petCritDmg+buffCritDMG-1))*(1+revengeDmgTotal+petDmgIncrese)*defRate;
      const dmgWeakOnly=atkTotal*skillRate*(1+weakDmgTotal)*(1+revengeDmgTotal+petDmgIncrese)*defRate;
      const dmgBoth=atkTotal*skillRate*(1+(critDmg+petCritDmg+buffCritDMG-1))*(1+weakDmgTotal)*(1+revengeDmgTotal+petDmgIncrese)*defRate;
      const nono=atkTotal*skillRate*(1+revengeDmgTotal+petDmgIncrese);
      return{nono,dmgCritOnly,dmgWeakOnly,dmgBoth};
    }

    function showResult(prefix,d){
      const t=document.getElementById(`result${prefix}`);
      if(!d||!d.dmgBoth||d.dmgBoth<=0){t.innerHTML=`<span class='text-gray-400'>è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼</span>`;return;}
      t.innerHTML=`
      <div class="space-y-2">
        <p><b>ç„¡æš´æ“Šå¼±é»ï¼š</b>${Math.round(d.nono).toLocaleString()}</p>
        <p><b>åªè§¸ç™¼æš´æ“Šï¼š</b>${Math.round(d.dmgCritOnly).toLocaleString()}</p>
        <p><b>åªè§¸ç™¼å¼±é»ï¼š</b>${Math.round(d.dmgWeakOnly).toLocaleString()}</p>
        <p><b>æš´æ“Šï¼‹å¼±é»ï¼š</b><span class="text-blue-600 font-bold">${Math.round(d.dmgBoth).toLocaleString()}</span></p>
      </div>`;
    }

    function showDiff(a,b){
      const res=document.getElementById('compareResult');
      if(!a||!b){res.innerText='è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼';return;}
      const diff=((b-a)/a)*100;
      const sign=diff>=0?'å¤š':'å°‘';
      const color=diff>=0?'text-green-600':'text-red-600';
      res.innerHTML=`B æ¯” A <span class="${color} font-bold">${sign}${Math.abs(diff).toFixed(2)}%</span>`;
    }

    function syncFromAtoB(id){
      const a=el('A',id),b=el('B',id);
      if(!a||!b)return;
      if(b.dataset.userEdited==='true'&&b.value!=='')return;
      b.value=a.value;
      b.dataset.autoSynced='true';
      b.classList.add('bg-gray-200','lock-icon');
      save('B',id,b.value);
    }

    function syncAll(){fields.forEach(id=>syncFromAtoB(id));}

    function onInput(e){
      const n=e.target,p=n.closest('#A')?'A':'B';
      save(p,n.id,n.value);
      if(p==='A')syncFromAtoB(n.id);
      if(p==='B'){
        if(n.value!==''){n.dataset.userEdited='true';n.classList.remove('bg-gray-200','lock-icon');}
        else{n.dataset.userEdited='false';syncFromAtoB(n.id);}
      }
      updateDisplay();
    }

    function updateDisplay(){
      syncAll();
      const A=calculate('A'),B=calculate('B');
      showResult('A',A);showResult('B',B);
      if(!A.dmgBoth||!B.dmgBoth){document.getElementById('compareResult').innerText='è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼';return;}
      showDiff(A.dmgBoth,B.dmgBoth);
    }

    function resetAll(){
      if(!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸å€¼å—ï¼Ÿ'))return;
      ['A','B'].forEach(p=>fields.forEach(id=>localStorage.removeItem(`${p}_${id}`)));
      document.querySelectorAll('input,select').forEach(i=>{
        i.value='';i.classList.remove('bg-gray-200','lock-icon');i.dataset.userEdited='false';
      });
      document.getElementById('resultA').innerText='è«‹è¼¸å…¥æ•¸å€¼';
      document.getElementById('resultB').innerText='è«‹è¼¸å…¥æ•¸å€¼';
      document.getElementById('compareResult').innerText='è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼';
    }

    loadSaved();
    document.querySelectorAll('input,select').forEach(i=>{
      i.addEventListener('input',onInput);
      i.dataset.userEdited='false';
    });
    syncAll();
    updateDisplay();
    document.getElementById('resetBtn').addEventListener('click',resetAll);
  </script>
</body>
</html>

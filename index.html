<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>雙欄裝備比較</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  input[type="number"]::-webkit-inner-spin-button {
    opacity: 1;
  }
  .input-box {
    text-align: right;
    padding-right: 22px;
    border: 1px solid #ddd;
    border-radius: 6px;
    height: 30px;
    width: 100%;
  }
  .gray-input {
    background-color: #f3f4f6;
  }
  .percent-box {
    position: relative;
  }
  .percent-box::after {
    content: "%";
    position: absolute;
    right: 8px;
    top: 4px;
    color: #555;
    font-size: 0.9rem;
  }
  .diff-box {
    text-align: right;
    padding-right: 18px;
    border: 1px solid #ccc;
    border-radius: 6px;
    height: 30px;
    background-color: #fff;
  }
  .diff-box::after {
    content: "%";
    position: absolute;
    right: 6px;
    color: #666;
  }
  .section-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
  }
</style>
</head>

<body class="bg-gray-100 flex flex-col items-center py-6">
  <div class="flex gap-10">
    <!-- 左欄 -->
    <div id="leftPanel" class="bg-white shadow rounded-2xl p-4 w-[320px]">
      <h3 class="section-title">🛠 主輸出</h3>
      <div class="grid gap-2" id="mainOutputLeft"></div>

      <h3 class="section-title">✨ BUFF（選填）</h3>
      <div class="grid gap-2" id="buffLeft"></div>

      <h3 class="section-title">🐉 寵物</h3>
      <div class="grid gap-2" id="petLeft"></div>

      <h3 class="section-title">🛡 敵人</h3>
      <div class="grid gap-2" id="enemyLeft"></div>
    </div>

    <!-- 中間差值欄 -->
    <div id="diffPanel" class="flex flex-col justify-start mt-9 gap-[14px] w-[70px] text-center"></div>

    <!-- 右欄 -->
    <div id="rightPanel" class="bg-white shadow rounded-2xl p-4 w-[320px]">
      <h3 class="section-title">🛠 主輸出</h3>
      <div class="grid gap-2" id="mainOutputRight"></div>

      <h3 class="section-title">✨ BUFF（選填）</h3>
      <div class="grid gap-2" id="buffRight"></div>

      <h3 class="section-title">🐉 寵物</h3>
      <div class="grid gap-2" id="petRight"></div>

      <h3 class="section-title">🛡 敵人</h3>
      <div class="grid gap-2" id="enemyRight"></div>
    </div>
  </div>

  <!-- 結果顯示 -->
  <div class="bg-white shadow rounded-2xl p-4 mt-8 w-[720px] text-center">
    <h3 class="text-lg font-semibold mb-3">📊 計算結果</h3>
    <p id="leftResult" class="text-gray-700 mb-1"></p>
    <p id="rightResult" class="text-gray-700 mb-1"></p>
    <p id="compareResult" class="font-semibold mt-2"></p>
  </div>

<script>
const fields = [
  { name: "面板攻擊力", type: "number" },
  { name: "基礎攻擊力", type: "number" },
  { name: "招式倍率", type: "percent" },
  { name: "暴擊傷害", type: "percent" },
  { name: "陣型提升攻擊力", type: "percent" },
  { name: "攻擊力增加", type: "percent", section: "buff" },
  { name: "弱點傷害增加", type: "percent", section: "buff" },
  { name: "傷害量增加", type: "percent", section: "buff" },
  { name: "暴擊傷害增加", type: "percent", section: "buff" },
  { name: "減少防禦力", type: "percent", section: "buff" },
  { name: "無視防禦", type: "percent", section: "buff" },
  { name: "寵物攻擊力", type: "number", section: "pet" },
  { name: "敵方防禦力", type: "number", section: "enemy" },
  { name: "物理/魔法減傷", type: "percent", section: "enemy" },
  { name: "增加防禦力", type: "percent", section: "enemy" },
];

function createRow(field, index) {
  const leftDiv = document.getElementById(field.section ? `${field.section}Left` : "mainOutputLeft");
  const rightDiv = document.getElementById(field.section ? `${field.section}Right` : "mainOutputRight");
  const diffDiv = document.getElementById("diffPanel");

  const leftInput = document.createElement("input");
  leftInput.type = "number";
  leftInput.className = `input-box ${field.type === "percent" ? "percent-box" : ""}`;
  leftInput.id = `left-${index}`;

  const rightInput = document.createElement("input");
  rightInput.type = "number";
  rightInput.className = `input-box gray-input ${field.type === "percent" ? "percent-box" : ""}`;
  rightInput.id = `right-${index}`;

  const diffInput = document.createElement("input");
  diffInput.type = "number";
  diffInput.placeholder = "+/-";
  diffInput.className = `diff-box ${field.type === "percent" ? "percent-box" : ""}`;
  diffInput.id = `diff-${index}`;

  function syncRight() {
    if (diffInput.value === "" && document.activeElement !== rightInput) {
      rightInput.value = leftInput.value;
      rightInput.classList.add("gray-input");
    }
  }

  leftInput.addEventListener("input", () => {
    if (diffInput.value === "") syncRight();
    updateResult();
  });

  diffInput.addEventListener("input", () => {
    const base = parseFloat(leftInput.value) || 0;
    const diff = parseFloat(diffInput.value);
    if (diffInput.value === "") {
      rightInput.value = leftInput.value;
      rightInput.classList.add("gray-input");
    } else if (!isNaN(diff)) {
      rightInput.value = base + diff;
      rightInput.classList.remove("gray-input");
    }
    updateResult();
  });

  rightInput.addEventListener("input", () => {
    if (rightInput.value !== leftInput.value) {
      rightInput.classList.remove("gray-input");
    } else {
      rightInput.classList.add("gray-input");
    }
    updateResult();
  });

  const label = document.createElement("label");
  label.textContent = field.name;
  label.className = "whitespace-nowrap";

  const leftRow = document.createElement("div");
  leftRow.className = "flex justify-between items-center gap-2";
  leftRow.append(label, leftInput);
  leftDiv.appendChild(leftRow);

  const rightRow = document.createElement("div");
  rightRow.className = "flex justify-between items-center gap-2";
  rightRow.append(label.cloneNode(true), rightInput);
  rightDiv.appendChild(rightRow);

  const diffWrapper = document.createElement("div");
  diffWrapper.appendChild(diffInput);
  diffDiv.appendChild(diffWrapper);
}

fields.forEach((f, i) => createRow(f, i));

function calcDamage(values) {
  const atk = parseFloat(values["面板攻擊力"]) || 0;
  const base = parseFloat(values["基礎攻擊力"]) || 0;
  const skill = (parseFloat(values["招式倍率"]) || 0) / 100;
  const critDmg = 1 + (parseFloat(values["暴擊傷害"]) || 0) / 100;
  const buff = 1 + (parseFloat(values["傷害量增加"]) || 0) / 100;
  const pet = parseFloat(values["寵物攻擊力"]) || 0;

  const normal = (atk + base + pet) * skill * buff;
  const onlyCrit = normal * critDmg;
  const onlyWeak = normal * 1.35;
  const both = normal * critDmg * 1.35;

  return { onlyCrit, onlyWeak, both };
}

function updateResult() {
  const leftValues = {};
  const rightValues = {};

  fields.forEach((f, i) => {
    leftValues[f.name] = document.getElementById(`left-${i}`).value;
    rightValues[f.name] = document.getElementById(`right-${i}`).value;
  });

  const left = calcDamage(leftValues);
  const right = calcDamage(rightValues);

  document.getElementById("leftResult").innerHTML = `
    左欄：暴擊 ${left.onlyCrit.toFixed(0)} ｜ 弱點 ${left.onlyWeak.toFixed(0)} ｜ 同時 ${left.both.toFixed(0)}
  `;
  document.getElementById("rightResult").innerHTML = `
    右欄：暴擊 ${right.onlyCrit.toFixed(0)} ｜ 弱點 ${right.onlyWeak.toFixed(0)} ｜ 同時 ${right.both.toFixed(0)}
  `;

  const diff = ((right.both - left.both) / left.both) * 100;
  document.getElementById("compareResult").innerHTML =
    `差異：${diff >= 0 ? "+" : ""}${diff.toFixed(2)}%`;
}
</script>
</body>
</html>

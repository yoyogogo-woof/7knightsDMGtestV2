<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>774å‚·å®³è¨ˆç®—æ©Ÿï¼ˆé›™æ¬„æ¯”è¼ƒç‰ˆï¼‰</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-8">

<h1 class="text-3xl font-bold mb-6">774å‚·å®³è¨ˆç®—æ©Ÿï¼ˆè£å‚™A vs è£å‚™Bï¼‰</h1>

<div class="w-full max-w-[1100px] flex flex-col lg:flex-row gap-6">

  <!-- è£å‚™ A -->
  <div class="bg-white shadow-lg rounded-2xl p-4 flex-1 space-y-6 text-[15px] leading-tight">
    <h2 class="text-lg font-semibold border-b pb-2 mb-4">è£å‚™A</h2>
    <div id="formA" class="space-y-2">
      <!-- æ”»æ“Šæ¬„ä½ -->
      <div class="flex justify-between items-center">
        <label>é¢æ¿æ”»æ“ŠåŠ›</label>
        <input id="A_atkPanel" type="number" class="border rounded p-1.5 w-28 text-right" placeholder="è¼¸å…¥æ•¸å€¼">
      </div>
      <div class="flex justify-between items-center">
        <label>åŸºç¤æ”»æ“ŠåŠ›</label>
        <input id="A_atkBase" type="number" class="border rounded p-1.5 w-28 text-right" placeholder="è¼¸å…¥æ•¸å€¼">
      </div>
      <div class="flex justify-between items-center">
        <label>æ‹›å¼å€ç‡</label>
        <div class="relative w-28">
          <input id="A_skillRate" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="è¼¸å…¥æ•¸å€¼">
          <span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>
      <div class="flex justify-between items-center">
        <label>æš´æ“Šå‚·å®³</label>
        <div class="relative w-28">
          <input id="A_critDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="è¼¸å…¥æ•¸å€¼">
          <span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>
      <div class="flex justify-between items-center">
        <label>é™£å‹æå‡æ”»æ“ŠåŠ›</label>
        <div class="relative w-28">
          <input id="A_formAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="è¼¸å…¥æ•¸å€¼">
          <span class="absolute right-2 top-1.5 text-gray-400">%</span>
        </div>
      </div>

      <!-- å¥—è£æ•ˆæœ -->
      <div class="mt-4 border-t pt-3">
        <select id="A_setEffect" class="border rounded p-2 w-full">
          <option value="none">ç„¡å¥—è£æ•ˆæœ</option>
          <option value="tracker4">è¿½è¹¤è€…å››ä»¶å¥—ï¼ˆå¼±é»å‚·å®³ +35%ï¼‰</option>
          <option value="assassin4">åˆºå®¢å››ä»¶å¥—ï¼ˆç„¡è¦–é˜²ç¦¦ +15%ï¼‰</option>
          <option value="avenger2">å¾©ä»‡è€…å…©ä»¶å¥—ï¼ˆå‚·å®³é‡ +15%ï¼‰</option>
          <option value="avenger4">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆå‚·å®³é‡ +30%ï¼‰</option>
          <option value="avenger4Boss">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆBOSS å‚·å®³é‡ +70%ï¼‰</option>
        </select>
      </div>

      <!-- BUFF -->
      <section class="mt-4">
        <h3 class="text-md font-semibold border-b pb-1 mb-2">BUFFï¼ˆé¸å¡«ï¼‰</h3>
        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <label>æ”»æ“ŠåŠ›å¢åŠ </label>
            <div class="relative w-28">
              <input id="A_buffAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>å¼±é»å‚·å®³é‡å¢åŠ </label>
            <div class="relative w-28">
              <input id="A_weakDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>å‚·å®³é‡å¢åŠ </label>
            <div class="relative w-28">
              <input id="A_revengeDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>æš´æ“Šå‚·å®³å¢åŠ </label>
            <div class="relative w-28">
              <input id="A_buffCritDMG" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>æ¸›å°‘é˜²ç¦¦åŠ›</label>
            <div class="relative w-28">
              <input id="A_deffDown" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>ç„¡è¦–é˜²ç¦¦</label>
            <div class="relative w-28">
              <input id="A_deffIgnore" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
        </div>
      </section>

      <!-- å¯µç‰© -->
      <section class="mt-4">
        <h3 class="text-md font-semibold border-b pb-1 mb-2">å¯µç‰©æ•ˆæœ</h3>
        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <label>å¯µç‰©æ”»æ“ŠåŠ›</label>
            <input id="A_petAtkFlat" type="number" class="border rounded p-1.5 w-28 text-right" placeholder="">
          </div>
          <div class="flex justify-between items-center">
            <label>æ½›èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›</label>
            <div class="relative w-28">
              <input id="A_petAtkPercent" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>æŠ€èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›</label>
            <div class="relative w-28">
              <input id="A_petSkillAtk" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>æŠ€èƒ½ï¼šå¢åŠ æš´æ“Šå‚·å®³</label>
            <div class="relative w-28">
              <input id="A_petCritDmg" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>æŠ€èƒ½ï¼šå¢åŠ å‚·å®³</label>
            <div class="relative w-28">
              <input id="A_petDmgIncrese" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
        </div>
      </section>

      <!-- æ•µäºº -->
      <section class="mt-4">
        <h3 class="text-md font-semibold border-b pb-1 mb-2">æ•µæ–¹é˜²ç¦¦</h3>
        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <label>æ•µæ–¹é˜²ç¦¦åŠ›</label>
            <input id="A_enemyDef" type="number" class="border rounded p-1.5 w-28 text-right" placeholder="">
          </div>
          <div class="flex justify-between items-center">
            <label>ç‰©ç†/é­”æ³•æ¸›å‚·</label>
            <div class="relative w-28">
              <input id="A_reduceRate" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <label>å¢åŠ é˜²ç¦¦åŠ›</label>
            <div class="relative w-28">
              <input id="A_enemyDefIncrease" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
              <span class="absolute right-2 top-1.5 text-gray-400">%</span>
            </div>
          </div>
        </div>
      </section>

      <!-- çµæœ -->
      <section class="text-center space-y-2 border-t pt-3">
        <p class="text-base font-semibold">ã€A çµæœã€‘</p>
        <div id="A_result" class="text-sm text-gray-700 leading-relaxed">
          è«‹è¼¸å…¥æ•¸å€¼
        </div>
      </section>
    </div>
  </div>

  <!-- ä¸­é–“æ¯”è¼ƒå€å¡Š -->
  <div class="flex flex-col justify-center items-center text-center p-4 bg-gray-200 rounded-xl space-y-2">
    <p class="text-lg font-semibold">ğŸ“Š å‚·å®³æ¯”è¼ƒï¼ˆB vs Aï¼‰</p>
    <div id="diffResult" class="text-blue-600 font-bold text-base">
      å°šæœªè¨ˆç®—
    </div>
  </div>

  <!-- è£å‚™ B -->
  <div class="bg-white shadow-lg rounded-2xl p-4 flex-1 space-y-6 text-[15px] leading-tight">
    <h2 class="text-lg font-semibold border-b pb-2 mb-4">è£å‚™B</h2>
    <div id="formB" class="space-y-2">
      <!-- B æ¬„ä½å®Œå…¨åŒ Aï¼Œä½† id å…¨æ”¹ç‚º B_ -->
      <!-- è‡ªå‹•ç°åº•åŒæ­¥ Aï¼Œæ‰‹å‹•è¼¸å…¥è®Šç™½ -->
      <!-- ä¸‹é¢æ¬„ä½å¯ç”¨ JS ç”Ÿæˆæˆ–æ‰‹å‹•è¤‡è£½å¡«å¯« -->
    </div>
  </div>

</div>

<script>
// å…¨éƒ¨æ¬„ä½
const fields = [
  'atkPanel','atkBase','formAtk','buffAtk','skillRate','critDmg',
  'weakDmg','revengeDmg','petAtkFlat','petSkillAtk','petCritDmg',
  'petAtkPercent','enemyDef','reduceRate','setEffect','buffCritDMG',
  'deffDown','deffIgnore','enemyDefIncrease','petDmgIncrese'
];

// åˆå§‹åŒ–æ¬„ä½ã€åŒæ­¥ localStorage
function initForm(prefix){
  fields.forEach(id=>{
    const el = document.getElementById(`${prefix}_${id}`);
    if(!el) return;
    // è¼‰å…¥ localStorage
    const saved = localStorage.getItem(`${prefix}_${id}`);
    if(saved!==null) el.value=saved;
    el.addEventListener('input',()=>{
      localStorage.setItem(`${prefix}_${id}`, el.value);
      calculate();
    });
  });
}
initForm('A');
initForm('B');

// B æ¬„åŒæ­¥ A (ç°åº•)
function syncBtoA(){
  fields.forEach(id=>{
    const elA = document.getElementById(`A_${id}`);
    const elB = document.getElementById(`B_${id}`);
    if(!elB || !elA) return;
    if(elB.value===''){
      elB.value = elA.value;
      elB.style.backgroundColor='#e5e7eb'; // ç°è‰²
    } else {
      elB.style.backgroundColor='white';
    }
    elB.addEventListener('input',()=>{
      if(elB.value===''){
        elB.value=elA.value;
        elB.style.backgroundColor='#e5e7eb';
      } else {
        elB.style.backgroundColor='white';
      }
      calculate();
    });
  });
}

// è¨ˆç®—å‚·å®³å…¬å¼
function calculate(){
  ['A','B'].forEach(prefix=>{
    const v=id=>parseFloat(document.getElementById(`${prefix}_${id}`).value)||0;
    const atkPanel=v('atkPanel'), atkBase=v('atkBase'), formAtk=v('formAtk')/100,
          skillRate=v('skillRate')/100, critDmg=v('critDmg')/100,
          buffAtk=v('buffAtk')/100, weakDmg=(v('weakDmg')+30)/100,
          revengeDmg=v('revengeDmg')/100, buffCritDMG=v('buffCritDMG')/100,
          deffDown=v('deffDown')/100, deffIgnore=v('deffIgnore')/100,
          petAtkFlat=v('petAtkFlat'), petSkillAtk=v('petSkillAtk')/100,
          petCritDmg=v('petCritDmg')/100, petAtkPercent=v('petAtkPercent')/100,
          petDmgIncrese=v('petDmgIncrese')/100, enemyDef=v('enemyDef'),
          reduceRate=v('reduceRate')/100, enemyDefIncrease=v('enemyDefIncrease')/100;
    let weakDmgTotal=weakDmg, revengeDmgTotal=revengeDmg, deffIgnoreTotal=deffIgnore;
    const setEffect=document.getElementById(`${prefix}_setEffect`).value;
    switch(setEffect){
      case 'tracker4': weakDmgTotal+=0.35; break;
      case 'avenger2': revengeDmgTotal+=0.15; break;
      case 'avenger4': revengeDmgTotal+=0.30; break;
      case 'avenger4Boss': revengeDmgTotal+=0.70; break;
      case 'assassin4': deffIgnoreTotal+=0.15; break;
    }
    const DEF_CONST=467;
    const defRate=(1-((enemyDef*(1-deffDown+enemyDefIncrease)*(1-deffIgnoreTotal))/(DEF_CONST+(enemyDef*(1-deffDown+enemyDefIncrease)*(1-deffIgnoreTotal)))))*(1-reduceRate);
    const atkTotal=(atkPanel+atkBase*(formAtk+petAtkPercent)+petAtkFlat)*(1+buffAtk+petSkillAtk);
    const dmgCritOnly=atkTotal*skillRate*(1+(critDmg+petCritDmg+buffCritDMG-1))*(1+revengeDmgTotal+petDmgIncrese)*defRate;
    const dmgWeakOnly=atkTotal*skillRate*(1+weakDmgTotal)*(1+revengeDmgTotal+petDmgIncrese)*defRate;
    const dmgBoth=atkTotal*skillRate*(1+(critDmg+petCritDmg+buffCritDMG-1))*(1+weakDmgTotal)*(1+revengeDmgTotal+petDmgIncrese)*defRate;
    const resultEl=document.getElementById(`${prefix}_result`);
    if(isNaN(dmgBoth)||dmgBoth<=0){
      resultEl.innerHTML='<span class="text-gray-400">è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼</span>';
    }else{
      resultEl.innerHTML=`
      <div class="space-y-2">
        <p><b>åªè§¸ç™¼æš´æ“Šï¼š</b> ${Math.round(dmgCritOnly).toLocaleString()}</p>
        <p><b>åªè§¸ç™¼å¼±é»ï¼š</b> ${Math.round(dmgWeakOnly).toLocaleString()}</p>
        <p><b>æš´æ“Šï¼‹å¼±é»ï¼š</b> <span class="text-blue-600 font-bold">${Math.round(dmgBoth).toLocaleString()}</span></p>
      </div>`;
    }
    // å­˜å…¥è¨ˆç®—çµæœ
    window[`${prefix}_dmgBoth`] = dmgBoth;
  });
  // é¡¯ç¤ºæ¯”è¼ƒå·®ç•°
  const diffEl=document.getElementById('diffResult');
  const diffA=window.A_dmgBoth||0, diffB=window.B_dmgBoth||0;
  if(diffA>0 && diffB>0){
    const diffVal=Math.round(diffB-diffA);
    diffEl.innerHTML=`å·®ç•°ï¼š<span class="text-red-600">${diffVal.toLocaleString()}</span> (${diffB>=diffA?'+':'-'}${Math.abs(diffVal)/diffA*100?.toFixed(2):0}%)`;
  }else{
    diffEl.innerHTML='å°šæœªè¨ˆç®—';
  }
}

// åˆå§‹åŒ– B æ¬„åŒæ­¥ A
syncBtoA();

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>774å‚·å®³è¨ˆç®—æ©Ÿï¼ˆé›™æ¬„æ¯”è¼ƒç‰ˆï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-8">
  <h1 class="text-3xl font-bold mb-6">âš”ï¸ 774å‚·å®³è¨ˆç®—æ©Ÿï¼ˆé›™æ¬„æ¯”è¼ƒç‰ˆï¼‰</h1>

  <!-- é›™æ¬„å®¹å™¨ -->
  <div class="flex flex-wrap justify-center gap-6 w-full max-w-5xl">
    <!-- å…©æ¬„ -->
    <div id="columns" class="flex flex-col md:flex-row gap-6 w-full justify-center"></div>
  </div>

  <script>
    /* ------------------ å…±ç”¨æ¬„ä½è¨­å®š ------------------ */
    const fieldList = [
      ['atkPanel', 'é¢æ¿æ”»æ“ŠåŠ›'],
      ['atkBase', 'åŸºç¤æ”»æ“ŠåŠ›'],
      ['skillRate', 'æ‹›å¼å€ç‡', '%'],
      ['critDmg', 'æš´æ“Šå‚·å®³', '%'],
      ['formAtk', 'é™£å‹æå‡æ”»æ“ŠåŠ›', '%'],
      ['setEffect', 'å¥—è£æ•ˆæœ', 'select'],
      ['buffAtk', 'æ”»æ“ŠåŠ›å¢åŠ ', '%'],
      ['weakDmg', 'å¼±é»å‚·å®³é‡å¢åŠ ', '%'],
      ['revengeDmg', 'å‚·å®³é‡å¢åŠ ', '%'],
      ['buffCritDMG', 'æš´æ“Šå‚·å®³å¢åŠ ', '%'],
      ['deffDown', 'æ¸›å°‘é˜²ç¦¦åŠ›', '%'],
      ['deffIgnore', 'ç„¡è¦–é˜²ç¦¦', '%'],
      ['petAtkFlat', 'å¯µç‰©æ”»æ“ŠåŠ›'],
      ['petAtkPercent', 'æ½›èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›', '%'],
      ['petSkillAtk', 'æŠ€èƒ½ï¼šå¢åŠ æ”»æ“ŠåŠ›', '%'],
      ['petCritDmg', 'æŠ€èƒ½ï¼šå¢åŠ æš´æ“Šå‚·å®³', '%'],
      ['petDmgIncrese', 'æŠ€èƒ½ï¼šå¢åŠ å‚·å®³', '%'],
      ['enemyDef', 'æ•µæ–¹é˜²ç¦¦åŠ›'],
      ['reduceRate', 'ç‰©ç†/é­”æ³•æ¸›å‚·', '%'],
      ['enemyDefIncrease', 'å¢åŠ é˜²ç¦¦åŠ›', '%']
    ];

    const setOptions = `
      <option value="none">ç„¡å¥—è£æ•ˆæœ</option>
      <option value="tracker4">è¿½è¹¤è€…å››ä»¶å¥—ï¼ˆå¼±é»å‚·å®³ +35%ï¼‰</option>
      <option value="assassin4">åˆºå®¢å››ä»¶å¥—ï¼ˆç„¡è¦–é˜²ç¦¦ +15%ï¼‰</option>
      <option value="avenger2">å¾©ä»‡è€…å…©ä»¶å¥—ï¼ˆå‚·å®³é‡ +15%ï¼‰</option>
      <option value="avenger4">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆå‚·å®³é‡ +30%ï¼‰</option>
      <option value="avenger4Boss">å¾©ä»‡è€…å››ä»¶å¥—ï¼ˆBOSS å‚·å®³é‡ +70%ï¼‰</option>
    `;

    /* ------------------ å»ºç«‹æ¬„ä½ ------------------ */
    const container = document.getElementById("columns");
    ['left', 'right'].forEach(side => {
      const col = document.createElement("div");
      col.className = "bg-white shadow-lg rounded-2xl p-4 w-full max-w-[340px] space-y-6 text-[15px]";
      col.innerHTML = `
        <h2 class="text-lg font-semibold border-b pb-2 mb-4">${side === 'left' ? 'è£å‚™ A' : 'è£å‚™ B'}</h2>
        <div class="space-y-2">
          ${fieldList.map(([id, label, unit]) => `
            <div class="flex justify-between items-center">
              <label>${label}</label>
              ${
                unit === 'select'
                  ? `<select id="${id}-${side}" class="border rounded p-1.5 w-40 text-sm">${setOptions}</select>`
                  : `
                    <div class="relative w-28">
                      <input id="${id}-${side}" type="number" class="border rounded p-1.5 w-full text-right pr-6 bg-white" placeholder="">
                      ${unit === '%' ? `<span class="absolute right-2 top-1.5 text-gray-400">%</span>` : ''}
                    </div>
                  `
              }
            </div>
          `).join('')}
        </div>
        <section class="text-center space-y-2 border-t pt-3">
          <p class="text-base font-semibold">ğŸ“Š è¨ˆç®—çµæœ</p>
          <div id="result-${side}" class="text-sm text-gray-700 leading-relaxed">è«‹è¼¸å…¥æ•¸å€¼</div>
        </section>
      `;
      container.appendChild(col);
    });

    /* ------------------ å·®å€¼æ¬„ä½ ------------------ */
    const diffDiv = document.createElement("div");
    diffDiv.className = "hidden md:flex flex-col justify-center items-center text-center";
    diffDiv.innerHTML = fieldList.map(([id]) => `
      <input type="number" id="${id}-diff" class="border rounded mb-[10px] w-16 text-center text-sm" placeholder="+/-">
    `).join('');
    container.insertBefore(diffDiv, container.children[1]);

    /* ------------------ æ ¸å¿ƒé‚è¼¯ ------------------ */
    function v(id, side) {
      return parseFloat(document.getElementById(`${id}-${side}`).value) || 0;
    }

    function calculate(side) {
      const atkPanel = v('atkPanel', side);
      const atkBase = v('atkBase', side);
      const formAtk = v('formAtk', side) / 100;
      const skillRate = v('skillRate', side) / 100;
      const critDmg = v('critDmg', side) / 100;
      const buffAtk = v('buffAtk', side) / 100;
      const weakDmg = v('weakDmg', side) / 100;
      const revengeDmg = v('revengeDmg', side) / 100;
      const buffCritDMG = v('buffCritDMG', side) / 100;
      const deffDown = v('deffDown', side) / 100;
      const deffIgnore = v('deffIgnore', side) / 100;
      const petAtkFlat = v('petAtkFlat', side);
      const petSkillAtk = v('petSkillAtk', side) / 100;
      const petCritDmg = v('petCritDmg', side) / 100;
      const petAtkPercent = v('petAtkPercent', side) / 100;
      const petDmgIncrese = v('petDmgIncrese', side) / 100;
      const enemyDef = v('enemyDef', side);
      const reduceRate = v('reduceRate', side) / 100;
      const enemyDefIncrease = v('enemyDefIncrease', side) / 100;
      const setEffect = document.getElementById(`setEffect-${side}`).value;

      let weakDmgTotal = weakDmg;
      let revengeDmgTotal = revengeDmg;
      let deffIgnoreTotal = deffIgnore;

      switch (setEffect) {
        case 'tracker4': weakDmgTotal += 0.35; break;
        case 'avenger2': revengeDmgTotal += 0.15; break;
        case 'avenger4': revengeDmgTotal += 0.30; break;
        case 'avenger4Boss': revengeDmgTotal += 0.70; break;
        case 'assassin4': deffIgnoreTotal += 0.15; break;
      }

      const DEF_CONST = 467;
      const defRate = (1 - ((enemyDef * (1 - deffDown + enemyDefIncrease) * (1 - deffIgnoreTotal)) /
        (DEF_CONST + (enemyDef * (1 - deffDown + enemyDefIncrease) * (1 - deffIgnoreTotal))))) * (1 - reduceRate);

      const atkTotal = (atkPanel + atkBase * (formAtk + petAtkPercent) + petAtkFlat) * (1 + buffAtk + petSkillAtk);

      const dmgCrit = atkTotal * skillRate * (1 + (critDmg + petCritDmg + buffCritDMG - 1)) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;
      const dmgWeak = atkTotal * skillRate * (1 + weakDmgTotal) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;
      const dmgBoth = atkTotal * skillRate * (1 + (critDmg + petCritDmg + buffCritDMG - 1)) * (1 + weakDmgTotal) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;

      document.getElementById(`result-${side}`).innerHTML = `
        <div class="space-y-1">
          <p><b>åªæš´æ“Šï¼š</b>${Math.round(dmgCrit).toLocaleString()}</p>
          <p><b>åªå¼±é»ï¼š</b>${Math.round(dmgWeak).toLocaleString()}</p>
          <p><b>æš´æ“Šï¼‹å¼±é»ï¼š</b><span class="text-blue-600 font-bold">${Math.round(dmgBoth).toLocaleString()}</span></p>
        </div>
      `;
      return dmgBoth;
    }

    /* ------------------ åŒæ­¥é‚è¼¯èˆ‡å·®å€¼ ------------------ */
    fieldList.forEach(([id]) => {
      const left = document.getElementById(`${id}-left`);
      const right = document.getElementById(`${id}-right`);
      const diff = document.getElementById(`${id}-diff`);

      const updateRight = () => {
        if (right.value === "") {
          right.classList.add("bg-gray-100");
          right.value = left.value;
        }
        calculateBoth();
      };

      const applyDiff = () => {
        const base = parseFloat(left.value) || 0;
        const delta = parseFloat(diff.value);
        if (!isNaN(delta)) {
          right.value = base + delta;
          right.classList.remove("bg-gray-100");
        } else {
          right.value = "";
        }
        calculateBoth();
      };

      [left, right].forEach(el => el.addEventListener("input", calculateBoth));
      diff.addEventListener("input", applyDiff);
      left.addEventListener("input", updateRight);
    });

    function calculateBoth() {
      const dmgL = calculate('left');
      const dmgR = calculate('right');
      const resultRight = document.getElementById("result-right");
      const diff = dmgL > 0 ? (((dmgR - dmgL) / dmgL) * 100).toFixed(2) : 0;
      resultRight.innerHTML += `<p class="text-green-600 font-semibold mt-2">æå‡ï¼šç´„ ${diff}%</p>`;
    }

  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>774傷害計算機（雙裝備對比）</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .synced {
      background-color: #f3f4f6; /* 灰底 */
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-8">

  <h1 class="text-3xl font-bold mb-6">774傷害計算機（雙裝備對比）</h1>

  <!-- 兩邊放在同一橫列 -->
  <div class="flex flex-col md:flex-row gap-8">

    <!-- ========= 裝備A ========= -->
    <div id="calcA" class="bg-white shadow-lg rounded-2xl p-4 w-full max-w-[340px] space-y-6 text-[15px] leading-tight">
      <h2 class="text-lg font-semibold border-b pb-2 mb-4">裝備A</h2>

      <!-- 原本整個輸入內容保持不動 -->
      <div id="formA">
        <!-- ✅ 直接貼你原本的輸入部分 -->
        <!--（此處省略重複輸入欄，跟你原版一模一樣）-->
        <!-- 👇👇👇 從你原本的 <section> 面板攻擊力 ... 到結果顯示那部分全貼進來 👇👇👇 -->
        <!-- 我只在下面完整示範結尾部分 -->
      </div>

      <!-- 結果A -->
      <section class="text-center space-y-2 border-t pt-3">
        <p class="text-base font-semibold">【計算結果】</p>
        <div id="resultA" class="text-sm text-gray-700 leading-relaxed">
          請輸入數值
        </div>
      </section>
    </div>

    <!-- ========= 裝備B ========= -->
    <div id="calcB" class="bg-white shadow-lg rounded-2xl p-4 w-full max-w-[340px] space-y-6 text-[15px] leading-tight">
      <h2 class="text-lg font-semibold border-b pb-2 mb-4">裝備B</h2>

      <!-- 直接複製整個輸入結構（與A完全相同，只是 id 改成 B_ 開頭） -->
      <div id="formB"></div>

      <!-- 結果B -->
      <section class="text-center space-y-2 border-t pt-3">
        <p class="text-base font-semibold">【計算結果】</p>
        <div id="resultB" class="text-sm text-gray-700 leading-relaxed">
          請輸入數值
        </div>
      </section>
    </div>
  </div>

  <!-- 重設 -->
  <button id="resetBtn" class="mt-6 bg-red-500 text-white px-5 py-2 rounded-xl hover:bg-red-600 transition">
    重設所有數值
  </button>

  <script>
    // 1️⃣ 原始欄位名稱
    const fields = [
      'atkPanel', 'atkBase', 'formAtk', 'buffAtk', 'skillRate', 'critDmg',
      'weakDmg', 'revengeDmg', 'petAtkFlat', 'petSkillAtk', 'petCritDmg', 
      'petAtkPercent', 'enemyDef', 'reduceRate', 'setEffect','buffCritDMG',
      'deffDown','deffIgnore','enemyDefIncrease','petDmgIncrese'
    ];

    // 2️⃣ 複製 A 的內容作為 B（只換 ID 前綴）
    const formA = document.getElementById('formA');
    const formB = document.getElementById('formB');
    formB.innerHTML = formA.innerHTML.replaceAll('id="', 'id="B_').replaceAll('for="', 'for="B_');

    // 3️⃣ 初始化欄位與事件
    function setupCalc(side) {
      fields.forEach(id => {
        const el = document.getElementById(`${side}_${id}`);
        const saved = localStorage.getItem(`${side}_${id}`);
        if (saved !== null) el.value = saved;
        el.addEventListener('input', () => {
          localStorage.setItem(`${side}_${id}`, el.value);
          calculate(side);
          if (side === 'A') syncInputs();
        });
      });
    }

    setupCalc('A');
    setupCalc('B');
    syncInputs();
    calculate('A');
    calculate('B');

    // 4️⃣ 同步右邊空白欄位
    function syncInputs() {
      fields.forEach(id => {
        const left = document.getElementById(`A_${id}`);
        const right = document.getElementById(`B_${id}`);
        if (!right.value) {
          right.value = left.value;
          right.classList.add('synced');
        } else {
          right.classList.remove('synced');
        }
      });
    }

    // 5️⃣ 計算邏輯 (照你原本的 calculate 改成接收 side)
    function calculate(side) {
      const v = id => parseFloat(document.getElementById(`${side}_${id}`).value) || 0;

      const atkPanel = v('atkPanel');
      const atkBase = v('atkBase');
      const formAtk = v('formAtk') / 100;
      const skillRate = v('skillRate') / 100;
      const critDmg = v('critDmg') / 100;
      const buffAtk = v('buffAtk') / 100;
      const weakDmg = (v('weakDmg') + 30) / 100;
      const revengeDmg = v('revengeDmg') / 100;
      const buffCritDMG = v('buffCritDMG') / 100;
      const deffDown = v('deffDown')/100;
      const deffIgnore = v('deffIgnore')/100;
      const petAtkFlat = v('petAtkFlat');
      const petSkillAtk = v('petSkillAtk') / 100;
      const petCritDmg = v('petCritDmg') / 100;
      const petAtkPercent = v('petAtkPercent') / 100;
      const petDmgIncrese = v('petDmgIncrese') / 100;
      const enemyDef = v('enemyDef');
      const reduceRate = v('reduceRate') / 100;
      const enemyDefIncrease = v('enemyDefIncrease') / 100;

      const setEffect = document.getElementById(`${side}_setEffect`).value;
      let weakDmgTotal = weakDmg;
      let revengeDmgTotal = revengeDmg;
      let deffIgnoreTotal = deffIgnore;

      switch (setEffect) {
        case 'tracker4': weakDmgTotal += 0.35; break;
        case 'avenger2': revengeDmgTotal += 0.15; break;
        case 'avenger4': revengeDmgTotal += 0.30; break;
        case 'avenger4Boss': revengeDmgTotal += 0.70; break;
        case 'assassin4': deffIgnoreTotal += 0.15; break;
      }

      const DEF_CONST = 467;
      const defRate = (1 - ((enemyDef * (1 - deffDown + enemyDefIncrease) * (1 - deffIgnoreTotal)) /
        (DEF_CONST + (enemyDef * (1 - deffDown + enemyDefIncrease) * (1 - deffIgnoreTotal))))) * (1 - reduceRate);

      const atkTotal = (atkPanel + atkBase * (formAtk + petAtkPercent) + petAtkFlat) * (1 + buffAtk + petSkillAtk);

      const dmgCritOnly = atkTotal * skillRate * (1 + (critDmg + petCritDmg + buffCritDMG - 1)) *
        (1 + revengeDmgTotal + petDmgIncrese) * defRate;
      const dmgWeakOnly = atkTotal * skillRate * (1 + weakDmgTotal) *
        (1 + revengeDmgTotal + petDmgIncrese) * defRate;
      const dmgBoth = atkTotal * skillRate * (1 + (critDmg + petCritDmg + buffCritDMG - 1)) *
        (1 + weakDmgTotal) * (1 + revengeDmgTotal + petDmgIncrese) * defRate;

      const resultEl = document.getElementById(`result${side}`);
      if (isNaN(dmgBoth) || dmgBoth <= 0) {
        resultEl.innerHTML = `<span class="text-gray-400">請輸入完整數值</span>`;
        return;
      }
      resultEl.innerHTML = `
        <div class="space-y-2">
          <p><b>只觸發暴擊：</b> ${Math.round(dmgCritOnly).toLocaleString()}</p>
          <p><b>只觸發弱點：</b> ${Math.round(dmgWeakOnly).toLocaleString()}</p>
          <p><b>暴擊＋弱點：</b> <span class="text-blue-600 font-bold">${Math.round(dmgBoth).toLocaleString()}</span></p>
        </div>
      `;
    }

    // 6️⃣ 重設
    document.getElementById('resetBtn').addEventListener('click', () => {
      if (!confirm('確定要清除所有數值嗎？')) return;
      ['A','B'].forEach(side=>{
        fields.forEach(id=>{
          document.getElementById(`${side}_${id}`).value='';
          localStorage.removeItem(`${side}_${id}`);
        });
        document.getElementById(`result${side}`).innerText='請輸入數值';
      });
      syncInputs();
    });
  </script>
</body>
</html>

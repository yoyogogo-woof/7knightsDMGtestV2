<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>774 雙裝備比較計算機</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-8">

  <h1 class="text-3xl font-bold mb-6">774 雙裝備比較計算機</h1>

  <!-- 兩欄主容器 -->
  <div class="flex flex-col md:flex-row gap-6 w-full max-w-5xl justify-center">

    <!-- 左側：裝備A -->
    <div id="calcA" class="bg-white shadow-lg rounded-2xl p-4 w-full md:w-1/2 space-y-6 text-[15px] leading-tight">
      <h2 class="text-lg font-semibold border-b pb-2 mb-4 text-center">【裝備 A】</h2>
      <div id="inputsA"></div>
      <div class="text-center space-y-2 border-t pt-3">
        <p class="text-base font-semibold">【A計算結果】</p>
        <div id="resultA" class="text-sm text-gray-700 leading-relaxed">請輸入數值</div>
      </div>
    </div>

    <!-- 右側：裝備B -->
    <div id="calcB" class="bg-white shadow-lg rounded-2xl p-4 w-full md:w-1/2 space-y-6 text-[15px] leading-tight">
      <h2 class="text-lg font-semibold border-b pb-2 mb-4 text-center">【裝備 B】</h2>
      <div id="inputsB"></div>
      <div class="text-center space-y-2 border-t pt-3">
        <p class="text-base font-semibold">【B計算結果】</p>
        <div id="resultB" class="text-sm text-gray-700 leading-relaxed">請輸入數值</div>
      </div>
    </div>
  </div>

  <!-- 結果比較 -->
  <div class="mt-6 bg-white shadow-md rounded-xl p-4 text-center w-full max-w-md">
    <p class="text-base font-semibold mb-2">【裝備差異】</p>
    <div id="compareResult" class="text-lg font-bold text-blue-600">請輸入完整數值</div>
    <button id="resetBtn" class="mt-4 bg-red-500 text-white px-5 py-2 rounded-xl hover:bg-red-600 transition">重設所有數值</button>
  </div>

  <script>
    // 欄位定義
    const fields = [
      ['atkPanel','面板攻擊力',''],
      ['atkBase','基礎攻擊力',''],
      ['formAtk','陣型提升攻擊力','%'],
      ['skillRate','招式倍率','%'],
      ['critDmg','暴擊傷害','%'],
      ['buffAtk','攻擊力增加','%'],
      ['weakDmg','弱點傷害量增加','%'],
      ['revengeDmg','傷害量增加','%'],
      ['buffCritDMG','暴擊傷害增加','%'],
      ['deffDown','減少防禦力','%'],
      ['deffIgnore','無視防禦','%'],
      ['petAtkFlat','寵物攻擊力',''],
      ['petAtkPercent','潛能：增加攻擊力','%'],
      ['petSkillAtk','技能：增加攻擊力','%'],
      ['petCritDmg','技能：增加暴擊傷害','%'],
      ['petDmgIncrese','技能：增加傷害','%'],
      ['enemyDef','敵方防禦力',''],
      ['reduceRate','物理/魔法減傷','%'],
      ['enemyDefIncrease','增加防禦力','%']
    ];

    // 動態生成欄位
    function buildInputs(prefix, containerId) {
      const container = document.getElementById(containerId);
      fields.forEach(([id,label,unit])=>{
        const div = document.createElement('div');
        div.className = 'flex justify-between items-center mb-1';
        div.innerHTML = `
          <label>${label}</label>
          <div class="relative w-28">
            <input id="${prefix}_${id}" type="number" class="border rounded p-1.5 w-full text-right pr-6" placeholder="">
            ${unit ? `<span class="absolute right-2 top-1.5 text-gray-400">${unit}</span>` : ''}
          </div>`;
        container.appendChild(div);
      });
    }

    buildInputs('A','inputsA');
    buildInputs('B','inputsB');

    // 計算核心函式
    function calc(prefix){
      const v = id => parseFloat(document.getElementById(`${prefix}_${id}`).value) || 0;
      const formAtk = v('formAtk')/100, skillRate=v('skillRate')/100, critDmg=v('critDmg')/100;
      const buffAtk=v('buffAtk')/100, weakDmg=(v('weakDmg')+30)/100, revengeDmg=v('revengeDmg')/100;
      const buffCritDMG=v('buffCritDMG')/100, deffDown=v('deffDown')/100, deffIgnore=v('deffIgnore')/100;
      const petAtkFlat=v('petAtkFlat'), petSkillAtk=v('petSkillAtk')/100, petCritDmg=v('petCritDmg')/100;
      const petAtkPercent=v('petAtkPercent')/100, petDmgIncrese=v('petDmgIncrese')/100;
      const enemyDef=v('enemyDef'), reduceRate=v('reduceRate')/100, enemyDefIncrease=v('enemyDefIncrease')/100;

      const DEF_CONST=467;
      const defRate=(1-((enemyDef*(1-deffDown+enemyDefIncrease)*(1-deffIgnore))/(DEF_CONST+(enemyDef*(1-deffDown+enemyDefIncrease)*(1-deffIgnore)))))*(1-reduceRate);
      const atkTotal=(v('atkPanel')+v('atkBase')*(formAtk+petAtkPercent)+petAtkFlat)*(1+buffAtk+petSkillAtk);
      const revengeDmgTotal=revengeDmg, weakDmgTotal=weakDmg;

      const dmgBoth=atkTotal*skillRate*(1+(critDmg+petCritDmg+buffCritDMG-1))*(1+weakDmgTotal)*(1+revengeDmgTotal+petDmgIncrese)*defRate;
      return dmgBoth>0?dmgBoth:0;
    }

    // 同步邏輯
    function syncAndCalc(){
      fields.forEach(([id])=>{
        const a=document.getElementById(`A_${id}`);
        const b=document.getElementById(`B_${id}`);
        if(!b.value){
          b.value=a.value;
          b.classList.add('bg-gray-200');
        }else{
          b.classList.remove('bg-gray-200');
        }
      });

      const dmgA=calc('A');
      const dmgB=calc('B');
      const resultA=document.getElementById('resultA');
      const resultB=document.getElementById('resultB');
      const compare=document.getElementById('compareResult');

      if(!dmgA||!dmgB){
        resultA.innerText='請輸入數值';
        resultB.innerText='請輸入數值';
        compare.innerText='請輸入完整數值';
        return;
      }

      resultA.innerHTML=`<span class="font-bold text-blue-600">${Math.round(dmgA).toLocaleString()}</span>`;
      resultB.innerHTML=`<span class="font-bold text-blue-600">${Math.round(dmgB).toLocaleString()}</span>`;
      const diff=(dmgB-dmgA)/dmgA*100;
      const sign=diff>=0?'+':'';
      compare.innerHTML=`B 比 A ${sign}${diff.toFixed(2)}%`;
    }

    // 綁定事件
    document.querySelectorAll('input').forEach(i=>{
      i.addEventListener('input',syncAndCalc);
    });

    // 重設
    document.getElementById('resetBtn').addEventListener('click',()=>{
      if(!confirm('確定要清除所有數值嗎？'))return;
      document.querySelectorAll('input').forEach(i=>{
        i.value='';
        i.classList.remove('bg-gray-200');
      });
      document.getElementById('resultA').innerText='請輸入數值';
      document.getElementById('resultB').innerText='請輸入數值';
      document.getElementById('compareResult').innerText='請輸入完整數值';
    });

  </script>
</body>
</html>
